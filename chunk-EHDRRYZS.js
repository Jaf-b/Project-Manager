import{A as Bt,B as ql,C as Ul,D as Bl,E as jl,F as zl,G as pr,I as $l,J as Gl,K as Kl,L as Ql,M as Mt,N as Wl,O as Hl,S as Yl,_ as Xl,t as gr,u as Lo,v as Fl,w as Ol,x as Ml,y as ue,z as Ll}from"./chunk-HUQKMNOS.js";import{Ea as kl,c as Oo,d as C,g as Cl,ia as xl,ma as mr,na as Dl,x as Mo,ya as Nl}from"./chunk-U7I5EF3X.js";var Jl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zl={};var Jt,qo;(function(){var r;function t(w,p){function _(){}_.prototype=p.prototype,w.D=p.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(v,I,A){for(var y=Array(arguments.length-2),Ht=2;Ht<arguments.length;Ht++)y[Ht-2]=arguments[Ht];return p.prototype[I].apply(v,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,p,_){_||(_=0);var v=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)v[I]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(I=0;16>I;++I)v[I]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=w.g[0],_=w.g[1],I=w.g[2];var A=w.g[3],y=p+(A^_&(I^A))+v[0]+3614090360&4294967295;p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+v[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+v[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+v[3]+3250441966&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+v[4]+4118548399&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+v[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+v[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+v[7]+4249261313&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+v[8]+1770035416&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+v[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+v[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+v[11]+2304563134&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+v[12]+1804603682&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+v[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+v[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+v[15]+1236535329&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(I^A&(_^I))+v[1]+4129170786&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+v[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+v[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+v[0]+3921069994&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+v[5]+3593408605&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+v[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+v[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+v[4]+3889429448&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+v[9]+568446438&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+v[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+v[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+v[8]+1163531501&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+v[13]+2850285829&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+v[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+v[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+v[12]+2368359562&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(_^I^A)+v[5]+4294588738&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+v[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+v[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+v[14]+4259657740&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+v[1]+2763975236&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+v[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+v[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+v[10]+3200236656&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+v[13]+681279174&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+v[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+v[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+v[6]+76029189&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+v[9]+3654602809&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+v[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+v[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+v[2]+3299628645&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(I^(_|~A))+v[0]+4096336452&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+v[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+v[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+v[5]+4237533241&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+v[12]+1700485571&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+v[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+v[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+v[1]+2240044497&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+v[8]+1873313359&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+v[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+v[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+v[13]+1309151649&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+v[4]+4149444226&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+v[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+v[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+v[9]+3951481745&4294967295,w.g[0]=w.g[0]+p&4294967295,w.g[1]=w.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+A&4294967295}n.prototype.u=function(w,p){p===void 0&&(p=w.length);for(var _=p-this.blockSize,v=this.B,I=this.h,A=0;A<p;){if(I==0)for(;A<=_;)s(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<p;)if(v[I++]=w.charCodeAt(A++),I==this.blockSize){s(this,v),I=0;break}}else for(;A<p;)if(v[I++]=w[A++],I==this.blockSize){s(this,v),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var p=1;p<w.length-8;++p)w[p]=0;var _=8*this.o;for(p=w.length-8;p<w.length;++p)w[p]=_&255,_/=256;for(this.u(w),w=Array(16),p=_=0;4>p;++p)for(var v=0;32>v;v+=8)w[_++]=this.g[p]>>>v&255;return w};function i(w,p){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=p(w)}function a(w,p){this.h=p;for(var _=[],v=!0,I=w.length-1;0<=I;I--){var A=w[I]|0;v&&A==p||(_[I]=A,v=!1)}this.g=_}var u={};function l(w){return-128<=w&&128>w?i(w,function(p){return new a([p|0],0>p?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return D(d(-w));for(var p=[],_=1,v=0;w>=_;v++)p[v]=w/_|0,_*=4294967296;return new a(p,0)}function m(w,p){if(w.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(w.charAt(0)=="-")return D(m(w.substring(1),p));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(p,8)),v=g,I=0;I<w.length;I+=8){var A=Math.min(8,w.length-I),y=parseInt(w.substring(I,I+A),p);8>A?(A=d(Math.pow(p,A)),v=v.j(A).add(d(y))):(v=v.j(_),v=v.add(d(y)))}return v}var g=l(0),T=l(1),b=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-D(this).m();for(var w=0,p=1,_=0;_<this.g.length;_++){var v=this.i(_);w+=(0<=v?v:4294967296+v)*p,p*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(k(this))return"-"+D(this).toString(w);for(var p=d(Math.pow(w,6)),_=this,v="";;){var I=W(_,p).g;_=$(_,I.j(p));var A=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=I,x(_))return A+v;for(;6>A.length;)A="0"+A;v=A+v}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(var p=0;p<w.g.length;p++)if(w.g[p]!=0)return!1;return!0}function k(w){return w.h==-1}r.l=function(w){return w=$(this,w),k(w)?-1:x(w)?0:1};function D(w){for(var p=w.g.length,_=[],v=0;v<p;v++)_[v]=~w.g[v];return new a(_,~w.h).add(T)}r.abs=function(){return k(this)?D(this):this},r.add=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],v=0,I=0;I<=p;I++){var A=v+(this.i(I)&65535)+(w.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);v=y>>>16,A&=65535,y&=65535,_[I]=y<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function $(w,p){return w.add(D(p))}r.j=function(w){if(x(this)||x(w))return g;if(k(this))return k(w)?D(this).j(D(w)):D(D(this).j(w));if(k(w))return D(this.j(D(w)));if(0>this.l(b)&&0>w.l(b))return d(this.m()*w.m());for(var p=this.g.length+w.g.length,_=[],v=0;v<2*p;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(var I=0;I<w.g.length;I++){var A=this.i(v)>>>16,y=this.i(v)&65535,Ht=w.i(I)>>>16,Hn=w.i(I)&65535;_[2*v+2*I]+=y*Hn,j(_,2*v+2*I),_[2*v+2*I+1]+=A*Hn,j(_,2*v+2*I+1),_[2*v+2*I+1]+=y*Ht,j(_,2*v+2*I+1),_[2*v+2*I+2]+=A*Ht,j(_,2*v+2*I+2)}for(v=0;v<p;v++)_[v]=_[2*v+1]<<16|_[2*v];for(v=p;v<2*p;v++)_[v]=0;return new a(_,0)};function j(w,p){for(;(w[p]&65535)!=w[p];)w[p+1]+=w[p]>>>16,w[p]&=65535,p++}function U(w,p){this.g=w,this.h=p}function W(w,p){if(x(p))throw Error("division by zero");if(x(w))return new U(g,g);if(k(w))return p=W(D(w),p),new U(D(p.g),D(p.h));if(k(p))return p=W(w,D(p)),new U(D(p.g),p.h);if(30<w.g.length){if(k(w)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var _=T,v=p;0>=v.l(w);)_=X(_),v=X(v);var I=G(_,1),A=G(v,1);for(v=G(v,2),_=G(_,2);!x(v);){var y=A.add(v);0>=y.l(w)&&(I=I.add(_),A=y),v=G(v,1),_=G(_,1)}return p=$(w,I.j(p)),new U(I,p)}for(I=g;0<=w.l(p);){for(_=Math.max(1,Math.floor(w.m()/p.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),A=d(_),y=A.j(p);k(y)||0<y.l(w);)_-=v,A=d(_),y=A.j(p);x(A)&&(A=T),I=I.add(A),w=$(w,y)}return new U(I,w)}r.A=function(w){return W(this,w).h},r.and=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],v=0;v<p;v++)_[v]=this.i(v)&w.i(v);return new a(_,this.h&w.h)},r.or=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],v=0;v<p;v++)_[v]=this.i(v)|w.i(v);return new a(_,this.h|w.h)},r.xor=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],v=0;v<p;v++)_[v]=this.i(v)^w.i(v);return new a(_,this.h^w.h)};function X(w){for(var p=w.g.length+1,_=[],v=0;v<p;v++)_[v]=w.i(v)<<1|w.i(v-1)>>>31;return new a(_,w.h)}function G(w,p){var _=p>>5;p%=32;for(var v=w.g.length-_,I=[],A=0;A<v;A++)I[A]=0<p?w.i(A+_)>>>p|w.i(A+_+1)<<32-p:w.i(A+_);return new a(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,qo=Zl.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,Jt=Zl.Integer=a}).apply(typeof Jl<"u"?Jl:typeof self<"u"?self:typeof window<"u"?window:{});var xs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zt={};var Uo,tg,an,Bo,yr,Ds,jo,zo,$o;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof xs=="object"&&xs];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,c){if(c)t:{var h=n;o=o.split(".");for(var f=0;f<o.length-1;f++){var E=o[f];if(!(E in h))break t;h=h[E]}o=o[o.length-1],f=h[o],c=c(f),c!=f&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function i(o,c){o instanceof String&&(o+="");var h=0,f=!1,E={next:function(){if(!f&&h<o.length){var R=h++;return{value:c(R,o[R]),done:!1}}return f=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}s("Array.prototype.values",function(o){return o||function(){return i(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function m(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,f),o.apply(c,E)}}return function(){return o.apply(c,arguments)}}function T(o,c,h){return T=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:g,T.apply(null,arguments)}function b(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function x(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,E,R){for(var F=Array(arguments.length-2),et=2;et<arguments.length;et++)F[et-2]=arguments[et];return c.prototype[E].apply(f,F)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let f=0;f<c;f++)h[f]=o[f];return h}return[]}function D(o,c){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let E=o.length||0,R=f.length||0;o.length=E+R;for(let F=0;F<R;F++)o[E+F]=f[F]}else o.push(f)}}class ${constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(o){return/^[\s\xa0]*$/.test(o)}function U(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var X=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function G(o,c,h){for(let f in o)c.call(h,o[f],f,o)}function w(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(o,c){let h,f;for(let E=1;E<arguments.length;E++){f=arguments[E];for(h in f)o[h]=f[h];for(let R=0;R<_.length;R++)h=_[R],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function I(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=lo;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class Ht{constructor(){this.h=this.g=null}add(c,h){let f=Hn.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var Hn=new $(()=>new vm,o=>o.reset());class vm{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Yn,Xn=!1,lo=new Ht,Vc=()=>{let o=u.Promise.resolve(void 0);Yn=()=>{o.then(Tm)}};var Tm=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=Hn;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Xn=!1};function se(){this.s=this.s,this.C=this.C}se.prototype.s=!1,se.prototype.ma=function(){this.s||(this.s=!0,this.N())},se.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pt(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}pt.prototype.h=function(){this.defaultPrevented=!0};var Im=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function Jn(o,c){if(pt.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(X){t:{try{W(c.nodeName);var E=!0;break t}catch{}E=!1}E||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Em[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Jn.aa.h.call(this)}}x(Jn,pt);var Em={2:"touch",3:"pen",4:"mouse"};Jn.prototype.h=function(){Jn.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Zn="closure_listenable_"+(1e6*Math.random()|0),Am=0;function Sm(o,c,h,f,E){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=E,this.key=++Am,this.da=this.fa=!1}function ms(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function gs(o){this.src=o,this.g={},this.h=0}gs.prototype.add=function(o,c,h,f,E){var R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);var F=fo(o,c,f,E);return-1<F?(c=o[F],h||(c.fa=!1)):(c=new Sm(c,this.src,R,!!f,E),c.fa=h,o.push(c)),c};function ho(o,c){var h=c.type;if(h in o.g){var f=o.g[h],E=Array.prototype.indexOf.call(f,c,void 0),R;(R=0<=E)&&Array.prototype.splice.call(f,E,1),R&&(ms(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function fo(o,c,h,f){for(var E=0;E<o.length;++E){var R=o[E];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==f)return E}return-1}var mo="closure_lm_"+(1e6*Math.random()|0),go={};function Cc(o,c,h,f,E){if(f&&f.once)return Dc(o,c,h,f,E);if(Array.isArray(c)){for(var R=0;R<c.length;R++)Cc(o,c[R],h,f,E);return null}return h=wo(h),o&&o[Zn]?o.K(c,h,d(f)?!!f.capture:!!f,E):xc(o,c,h,!1,f,E)}function xc(o,c,h,f,E,R){if(!c)throw Error("Invalid event type");var F=d(E)?!!E.capture:!!E,et=yo(o);if(et||(o[mo]=et=new gs(o)),h=et.add(c,h,f,F,R),h.proxy)return h;if(f=Rm(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)Im||(E=F),E===void 0&&(E=!1),o.addEventListener(c.toString(),f,E);else if(o.attachEvent)o.attachEvent(kc(c.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Rm(){function o(h){return c.call(o.src,o.listener,h)}let c=bm;return o}function Dc(o,c,h,f,E){if(Array.isArray(c)){for(var R=0;R<c.length;R++)Dc(o,c[R],h,f,E);return null}return h=wo(h),o&&o[Zn]?o.L(c,h,d(f)?!!f.capture:!!f,E):xc(o,c,h,!0,f,E)}function Nc(o,c,h,f,E){if(Array.isArray(c))for(var R=0;R<c.length;R++)Nc(o,c[R],h,f,E);else f=d(f)?!!f.capture:!!f,h=wo(h),o&&o[Zn]?(o=o.i,c=String(c).toString(),c in o.g&&(R=o.g[c],h=fo(R,h,f,E),-1<h&&(ms(R[h]),Array.prototype.splice.call(R,h,1),R.length==0&&(delete o.g[c],o.h--)))):o&&(o=yo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=fo(c,h,f,E)),(h=-1<o?c[o]:null)&&po(h))}function po(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Zn])ho(c.i,o);else{var h=o.type,f=o.proxy;c.removeEventListener?c.removeEventListener(h,f,o.capture):c.detachEvent?c.detachEvent(kc(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=yo(c))?(ho(h,o),h.h==0&&(h.src=null,c[mo]=null)):ms(o)}}}function kc(o){return o in go?go[o]:go[o]="on"+o}function bm(o,c){if(o.da)o=!0;else{c=new Jn(c,this);var h=o.listener,f=o.ha||o.src;o.fa&&po(o),o=h.call(f,c)}return o}function yo(o){return o=o[mo],o instanceof gs?o:null}var _o="__closure_events_fn_"+(1e9*Math.random()>>>0);function wo(o){return typeof o=="function"?o:(o[_o]||(o[_o]=function(c){return o.handleEvent(c)}),o[_o])}function yt(){se.call(this),this.i=new gs(this),this.M=this,this.F=null}x(yt,se),yt.prototype[Zn]=!0,yt.prototype.removeEventListener=function(o,c,h,f){Nc(this,o,c,h,f)};function It(o,c){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=c.type||c,typeof c=="string")c=new pt(c,o);else if(c instanceof pt)c.target=c.target||o;else{var E=c;c=new pt(f,o),v(c,E)}if(E=!0,h)for(var R=h.length-1;0<=R;R--){var F=c.g=h[R];E=ps(F,f,!0,c)&&E}if(F=c.g=o,E=ps(F,f,!0,c)&&E,E=ps(F,f,!1,c)&&E,h)for(R=0;R<h.length;R++)F=c.g=h[R],E=ps(F,f,!1,c)&&E}yt.prototype.N=function(){if(yt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],f=0;f<h.length;f++)ms(h[f]);delete o.g[c],o.h--}}this.F=null},yt.prototype.K=function(o,c,h,f){return this.i.add(String(o),c,!1,h,f)},yt.prototype.L=function(o,c,h,f){return this.i.add(String(o),c,!0,h,f)};function ps(o,c,h,f){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var E=!0,R=0;R<c.length;++R){var F=c[R];if(F&&!F.da&&F.capture==h){var et=F.listener,mt=F.ha||F.src;F.fa&&ho(o.i,F),E=et.call(mt,f)!==!1&&E}}return E&&!f.defaultPrevented}function Fc(o,c,h){if(typeof o=="function")h&&(o=T(o,h));else if(o&&typeof o.handleEvent=="function")o=T(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Oc(o){o.g=Fc(()=>{o.g=null,o.i&&(o.i=!1,Oc(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class Pm extends se{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Oc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function tr(o){se.call(this),this.h=o,this.g={}}x(tr,se);var Mc=[];function Lc(o){G(o.g,function(c,h){this.g.hasOwnProperty(h)&&po(c)},o),o.g={}}tr.prototype.N=function(){tr.aa.N.call(this),Lc(this)},tr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var vo=u.JSON.stringify,Vm=u.JSON.parse,Cm=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function To(){}To.prototype.h=null;function qc(o){return o.h||(o.h=o.i())}function Uc(){}var er={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Io(){pt.call(this,"d")}x(Io,pt);function Eo(){pt.call(this,"c")}x(Eo,pt);var Ve={},Bc=null;function ys(){return Bc=Bc||new yt}Ve.La="serverreachability";function jc(o){pt.call(this,Ve.La,o)}x(jc,pt);function nr(o){let c=ys();It(c,new jc(c))}Ve.STAT_EVENT="statevent";function zc(o,c){pt.call(this,Ve.STAT_EVENT,o),this.stat=c}x(zc,pt);function Et(o){let c=ys();It(c,new zc(c,o))}Ve.Ma="timingevent";function $c(o,c){pt.call(this,Ve.Ma,o),this.size=c}x($c,pt);function rr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function sr(){this.g=!0}sr.prototype.xa=function(){this.g=!1};function xm(o,c,h,f,E,R){o.info(function(){if(o.g)if(R)for(var F="",et=R.split("&"),mt=0;mt<et.length;mt++){var Y=et[mt].split("=");if(1<Y.length){var _t=Y[0];Y=Y[1];var wt=_t.split("_");F=2<=wt.length&&wt[1]=="type"?F+(_t+"="+Y+"&"):F+(_t+"=redacted&")}}else F=null;else F=R;return"XMLHTTP REQ ("+f+") [attempt "+E+"]: "+c+`
`+h+`
`+F})}function Dm(o,c,h,f,E,R,F){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+E+"]: "+c+`
`+h+`
`+R+" "+F})}function nn(o,c,h,f){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+km(o,h)+(f?" "+f:"")})}function Nm(o,c){o.info(function(){return"TIMEOUT: "+c})}sr.prototype.info=function(){};function km(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var E=f[1];if(Array.isArray(E)&&!(1>E.length)){var R=E[0];if(R!="noop"&&R!="stop"&&R!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return vo(h)}catch{return c}}var _s={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Gc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ao;function ws(){}x(ws,To),ws.prototype.g=function(){return new XMLHttpRequest},ws.prototype.i=function(){return{}},Ao=new ws;function ie(o,c,h,f){this.j=o,this.i=c,this.l=h,this.R=f||1,this.U=new tr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Kc}function Kc(){this.i=null,this.g="",this.h=!1}var Qc={},So={};function Ro(o,c,h){o.L=1,o.v=Es(Yt(c)),o.m=h,o.P=!0,Wc(o,null)}function Wc(o,c){o.F=Date.now(),vs(o),o.A=Yt(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),ul(h.i,"t",f),o.C=0,h=o.j.J,o.h=new Kc,o.g=Rl(o.j,h?c:null,!o.m),0<o.O&&(o.M=new Pm(T(o.Y,o,o.g),o.O)),c=o.U,h=o.g,f=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Mc[0]=E.toString()),E=Mc);for(var R=0;R<E.length;R++){var F=Cc(h,E[R],f||c.handleEvent,!1,c.h||c);if(!F)break;c.g[F.key]=F}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),nr(),xm(o.i,o.u,o.A,o.l,o.R,o.m)}ie.prototype.ca=function(o){o=o.target;let c=this.M;c&&Xt(o)==3?c.j():this.Y(o)},ie.prototype.Y=function(o){try{if(o==this.g)t:{let wt=Xt(this.g);var c=this.g.Ba();let on=this.g.Z();if(!(3>wt)&&(wt!=3||this.g&&(this.h.h||this.g.oa()||gl(this.g)))){this.J||wt!=4||c==7||(c==8||0>=on?nr(3):nr(2)),bo(this);var h=this.g.Z();this.X=h;e:if(Hc(this)){var f=gl(this.g);o="";var E=f.length,R=Xt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ce(this),ir(this);var F="";break e}this.h.i=new u.TextDecoder}for(c=0;c<E;c++)this.h.h=!0,o+=this.h.i.decode(f[c],{stream:!(R&&c==E-1)});f.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,Dm(this.i,this.u,this.A,this.l,this.R,wt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var et,mt=this.g;if((et=mt.g?mt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(et)){var Y=et;break e}}Y=null}if(h=Y)nn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Po(this,h);else{this.o=!1,this.s=3,Et(12),Ce(this),ir(this);break t}}if(this.P){h=!0;let Ot;for(;!this.J&&this.C<F.length;)if(Ot=Fm(this,F),Ot==So){wt==4&&(this.s=4,Et(14),h=!1),nn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ot==Qc){this.s=4,Et(15),nn(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else nn(this.i,this.l,Ot,null),Po(this,Ot);if(Hc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),wt!=4||F.length!=0||this.h.h||(this.s=1,Et(16),h=!1),this.o=this.o&&h,!h)nn(this.i,this.l,F,"[Invalid Chunked Response]"),Ce(this),ir(this);else if(0<F.length&&!this.W){this.W=!0;var _t=this.j;_t.g==this&&_t.ba&&!_t.M&&(_t.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),ko(_t),_t.M=!0,Et(11))}}else nn(this.i,this.l,F,null),Po(this,F);wt==4&&Ce(this),this.o&&!this.J&&(wt==4?Il(this.j,this):(this.o=!1,vs(this)))}else Jm(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Et(12)):(this.s=0,Et(13)),Ce(this),ir(this)}}}catch{}finally{}};function Hc(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Fm(o,c){var h=o.C,f=c.indexOf(`
`,h);return f==-1?So:(h=Number(c.substring(h,f)),isNaN(h)?Qc:(f+=1,f+h>c.length?So:(c=c.slice(f,f+h),o.C=f+h,c)))}ie.prototype.cancel=function(){this.J=!0,Ce(this)};function vs(o){o.S=Date.now()+o.I,Yc(o,o.I)}function Yc(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=rr(T(o.ba,o),c)}function bo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}ie.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Nm(this.i,this.A),this.L!=2&&(nr(),Et(17)),Ce(this),this.s=2,ir(this)):Yc(this,this.S-o)};function ir(o){o.j.G==0||o.J||Il(o.j,o)}function Ce(o){bo(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Lc(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Po(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||Vo(h.h,o))){if(!o.K&&Vo(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var E=f;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Ps(h),Rs(h);else break t;No(h),Et(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=rr(T(h.Za,h),6e3));if(1>=Zc(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else De(h,11)}else if((o.K||h.g==o)&&Ps(h),!j(c))for(E=h.Da.g.parse(c),c=0;c<E.length;c++){let Y=E[c];if(h.T=Y[0],Y=Y[1],h.G==2)if(Y[0]=="c"){h.K=Y[1],h.ia=Y[2];let _t=Y[3];_t!=null&&(h.la=_t,h.j.info("VER="+h.la));let wt=Y[4];wt!=null&&(h.Aa=wt,h.j.info("SVER="+h.Aa));let on=Y[5];on!=null&&typeof on=="number"&&0<on&&(f=1.5*on,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let Ot=o.g;if(Ot){let Cs=Ot.g?Ot.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Cs){var R=f.h;R.g||Cs.indexOf("spdy")==-1&&Cs.indexOf("quic")==-1&&Cs.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Co(R,R.h),R.h=null))}if(f.D){let Fo=Ot.g?Ot.g.getResponseHeader("X-HTTP-Session-Id"):null;Fo&&(f.ya=Fo,nt(f.I,f.D,Fo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var F=o;if(f.qa=Sl(f,f.J?f.ia:null,f.W),F.K){tl(f.h,F);var et=F,mt=f.L;mt&&(et.I=mt),et.B&&(bo(et),vs(et)),f.g=F}else vl(f);0<h.i.length&&bs(h)}else Y[0]!="stop"&&Y[0]!="close"||De(h,7);else h.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?De(h,7):Do(h):Y[0]!="noop"&&h.l&&h.l.ta(Y),h.v=0)}}nr(4)}catch{}}var Om=class{constructor(o,c){this.g=o,this.map=c}};function Xc(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Jc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Zc(o){return o.h?1:o.g?o.g.size:0}function Vo(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Co(o,c){o.g?o.g.add(c):o.h=c}function tl(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}Xc.prototype.cancel=function(){if(this.i=el(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function el(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function Mm(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,f=0;f<h;f++)c.push(o[f]);return c}c=[],h=0;for(f in o)c[h++]=o[f];return c}function Lm(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let f in o)c[h++]=f;return c}}}function nl(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Lm(o),f=Mm(o),E=f.length,R=0;R<E;R++)c.call(void 0,f[R],h&&h[R],o)}var rl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qm(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),E=null;if(0<=f){var R=o[h].substring(0,f);E=o[h].substring(f+1)}else R=o[h];c(R,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function xe(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof xe){this.h=o.h,Ts(this,o.j),this.o=o.o,this.g=o.g,Is(this,o.s),this.l=o.l;var c=o.i,h=new ur;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),sl(this,h),this.m=o.m}else o&&(c=String(o).match(rl))?(this.h=!1,Ts(this,c[1]||"",!0),this.o=or(c[2]||""),this.g=or(c[3]||"",!0),Is(this,c[4]),this.l=or(c[5]||"",!0),sl(this,c[6]||"",!0),this.m=or(c[7]||"")):(this.h=!1,this.i=new ur(null,this.h))}xe.prototype.toString=function(){var o=[],c=this.j;c&&o.push(ar(c,il,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(ar(c,il,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(ar(h,h.charAt(0)=="/"?jm:Bm,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",ar(h,$m)),o.join("")};function Yt(o){return new xe(o)}function Ts(o,c,h){o.j=h?or(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Is(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function sl(o,c,h){c instanceof ur?(o.i=c,Gm(o.i,o.h)):(h||(c=ar(c,zm)),o.i=new ur(c,o.h))}function nt(o,c,h){o.i.set(c,h)}function Es(o){return nt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function or(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function ar(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Um),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Um(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var il=/[#\/\?@]/g,Bm=/[#\?:]/g,jm=/[#\?]/g,zm=/[#\?@]/g,$m=/#/g;function ur(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function oe(o){o.g||(o.g=new Map,o.h=0,o.i&&qm(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=ur.prototype,r.add=function(o,c){oe(this),this.i=null,o=rn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function ol(o,c){oe(o),c=rn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function al(o,c){return oe(o),c=rn(o,c),o.g.has(c)}r.forEach=function(o,c){oe(this),this.g.forEach(function(h,f){h.forEach(function(E){o.call(c,E,f,this)},this)},this)},r.na=function(){oe(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let f=0;f<c.length;f++){let E=o[f];for(let R=0;R<E.length;R++)h.push(c[f])}return h},r.V=function(o){oe(this);let c=[];if(typeof o=="string")al(this,o)&&(c=c.concat(this.g.get(rn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return oe(this),this.i=null,o=rn(this,o),al(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function ul(o,c,h){ol(o,c),0<h.length&&(o.i=null,o.g.set(rn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var f=c[h];let R=encodeURIComponent(String(f)),F=this.V(f);for(f=0;f<F.length;f++){var E=R;F[f]!==""&&(E+="="+encodeURIComponent(String(F[f]))),o.push(E)}}return this.i=o.join("&")};function rn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Gm(o,c){c&&!o.j&&(oe(o),o.i=null,o.g.forEach(function(h,f){var E=f.toLowerCase();f!=E&&(ol(this,f),ul(this,E,h))},o)),o.j=c}function Km(o,c){let h=new sr;if(u.Image){let f=new Image;f.onload=b(ae,h,"TestLoadImage: loaded",!0,c,f),f.onerror=b(ae,h,"TestLoadImage: error",!1,c,f),f.onabort=b(ae,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=b(ae,h,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else c(!1)}function Qm(o,c){let h=new sr,f=new AbortController,E=setTimeout(()=>{f.abort(),ae(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:f.signal}).then(R=>{clearTimeout(E),R.ok?ae(h,"TestPingServer: ok",!0,c):ae(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(E),ae(h,"TestPingServer: error",!1,c)})}function ae(o,c,h,f,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),f(h)}catch{}}function Wm(){this.g=new Cm}function Hm(o,c,h){let f=h||"";try{nl(o,function(E,R){let F=E;d(E)&&(F=vo(E)),c.push(f+R+"="+encodeURIComponent(F))})}catch(E){throw c.push(f+"type="+encodeURIComponent("_badmap")),E}}function cr(o){this.l=o.Ub||null,this.j=o.eb||!1}x(cr,To),cr.prototype.g=function(){return new As(this.l,this.j)},cr.prototype.i=function(o){return function(){return o}}({});function As(o,c){yt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(As,yt),r=As.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,hr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,lr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,hr(this)),this.g&&(this.readyState=3,hr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function cl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?lr(this):hr(this),this.readyState==3&&cl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,lr(this))},r.Qa=function(o){this.g&&(this.response=o,lr(this))},r.ga=function(){this.g&&lr(this)};function lr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,hr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function hr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(As.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ll(o){let c="";return G(o,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function xo(o,c,h){t:{for(f in h){var f=!1;break t}f=!0}f||(h=ll(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):nt(o,c,h))}function it(o){yt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(it,yt);var Ym=/^https?$/i,Xm=["POST","PUT"];r=it.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ao.g(),this.v=this.o?qc(this.o):qc(Ao),this.g.onreadystatechange=T(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){hl(this,R);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var E in f)h.set(E,f[E]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let R of f.keys())h.set(R,f.get(R));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Xm,c,void 0))||f||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,F]of h)this.g.setRequestHeader(R,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ml(this),this.u=!0,this.g.send(o),this.u=!1}catch(R){hl(this,R)}};function hl(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,dl(o),Ss(o)}function dl(o){o.A||(o.A=!0,It(o,"complete"),It(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,It(this,"complete"),It(this,"abort"),Ss(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ss(this,!0)),it.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?fl(this):this.bb())},r.bb=function(){fl(this)};function fl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Xt(o)!=4||o.Z()!=2)){if(o.u&&Xt(o)==4)Fc(o.Ea,0,o);else if(It(o,"readystatechange"),Xt(o)==4){o.h=!1;try{let F=o.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var f;if(f=F===0){var E=String(o.D).match(rl)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),f=!Ym.test(E?E.toLowerCase():"")}h=f}if(h)It(o,"complete"),It(o,"success");else{o.m=6;try{var R=2<Xt(o)?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.Z()+"]",dl(o)}}finally{Ss(o)}}}}function Ss(o,c){if(o.g){ml(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||It(o,"ready");try{h.onreadystatechange=f}catch{}}}function ml(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Xt(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Xt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Vm(c)}};function gl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Jm(o){let c={};o=(o.g&&2<=Xt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(j(o[f]))continue;var h=I(o[f]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let R=c[E]||[];c[E]=R,R.push(h)}w(c,function(f){return f.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function dr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function pl(o){this.Aa=0,this.i=[],this.j=new sr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=dr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=dr("baseRetryDelayMs",5e3,o),this.cb=dr("retryDelaySeedMs",1e4,o),this.Wa=dr("forwardChannelMaxRetries",2,o),this.wa=dr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Xc(o&&o.concurrentRequestLimit),this.Da=new Wm,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=pl.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,f){Et(0),this.W=o,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=Sl(this,null,this.W),bs(this)};function Do(o){if(yl(o),o.G==3){var c=o.U++,h=Yt(o.I);if(nt(h,"SID",o.K),nt(h,"RID",c),nt(h,"TYPE","terminate"),fr(o,h),c=new ie(o,o.j,c),c.L=2,c.v=Es(Yt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Rl(c.j,null),c.g.ea(c.v)),c.F=Date.now(),vs(c)}Al(o)}function Rs(o){o.g&&(ko(o),o.g.cancel(),o.g=null)}function yl(o){Rs(o),o.u&&(u.clearTimeout(o.u),o.u=null),Ps(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function bs(o){if(!Jc(o.h)&&!o.s){o.s=!0;var c=o.Ga;Yn||Vc(),Xn||(Yn(),Xn=!0),lo.add(c,o),o.B=0}}function Zm(o,c){return Zc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=rr(T(o.Ga,o,c),El(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new ie(this,this.j,o),R=this.o;if(this.S&&(R?(R=p(R),v(R,this.S)):R=this.S),this.m!==null||this.O||(E.H=R,R=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=wl(this,E,c),h=Yt(this.I),nt(h,"RID",o),nt(h,"CVER",22),this.D&&nt(h,"X-HTTP-Session-Id",this.D),fr(this,h),R&&(this.O?c="headers="+encodeURIComponent(String(ll(R)))+"&"+c:this.m&&xo(h,this.m,R)),Co(this.h,E),this.Ua&&nt(h,"TYPE","init"),this.P?(nt(h,"$req",c),nt(h,"SID","null"),E.T=!0,Ro(E,h,null)):Ro(E,h,c),this.G=2}}else this.G==3&&(o?_l(this,o):this.i.length==0||Jc(this.h)||_l(this))};function _l(o,c){var h;c?h=c.l:h=o.U++;let f=Yt(o.I);nt(f,"SID",o.K),nt(f,"RID",h),nt(f,"AID",o.T),fr(o,f),o.m&&o.o&&xo(f,o.m,o.o),h=new ie(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=wl(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Co(o.h,h),Ro(h,f,c)}function fr(o,c){o.H&&G(o.H,function(h,f){nt(c,f,h)}),o.l&&nl({},function(h,f){nt(c,f,h)})}function wl(o,c,h){h=Math.min(o.i.length,h);var f=o.l?T(o.l.Na,o.l,o):null;t:{var E=o.i;let R=-1;for(;;){let F=["count="+h];R==-1?0<h?(R=E[0].g,F.push("ofs="+R)):R=0:F.push("ofs="+R);let et=!0;for(let mt=0;mt<h;mt++){let Y=E[mt].g,_t=E[mt].map;if(Y-=R,0>Y)R=Math.max(0,E[mt].g-100),et=!1;else try{Hm(_t,F,"req"+Y+"_")}catch{f&&f(_t)}}if(et){f=F.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,f}function vl(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Yn||Vc(),Xn||(Yn(),Xn=!0),lo.add(c,o),o.v=0}}function No(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=rr(T(o.Fa,o),El(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Tl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=rr(T(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Et(10),Rs(this),Tl(this))};function ko(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Tl(o){o.g=new ie(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=Yt(o.qa);nt(c,"RID","rpc"),nt(c,"SID",o.K),nt(c,"AID",o.T),nt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&nt(c,"TO",o.ja),nt(c,"TYPE","xmlhttp"),fr(o,c),o.m&&o.o&&xo(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Es(Yt(c)),h.m=null,h.P=!0,Wc(h,o)}r.Za=function(){this.C!=null&&(this.C=null,Rs(this),No(this),Et(19))};function Ps(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Il(o,c){var h=null;if(o.g==c){Ps(o),ko(o),o.g=null;var f=2}else if(Vo(o.h,c))h=c.D,tl(o.h,c),f=1;else return;if(o.G!=0){if(c.o)if(f==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var E=o.B;f=ys(),It(f,new $c(f,h)),bs(o)}else vl(o);else if(E=c.s,E==3||E==0&&0<c.X||!(f==1&&Zm(o,c)||f==2&&No(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),E){case 1:De(o,5);break;case 4:De(o,10);break;case 3:De(o,6);break;default:De(o,2)}}}function El(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function De(o,c){if(o.j.info("Error code "+c),c==2){var h=T(o.fb,o),f=o.Xa;let E=!f;f=new xe(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ts(f,"https"),Es(f),E?Km(f.toString(),h):Qm(f.toString(),h)}else Et(2);o.G=0,o.l&&o.l.sa(c),Al(o),yl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Et(2)):(this.j.info("Failed to ping google.com"),Et(1))};function Al(o){if(o.G=0,o.ka=[],o.l){let c=el(o.h);(c.length!=0||o.i.length!=0)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Sl(o,c,h){var f=h instanceof xe?Yt(h):new xe(h);if(f.g!="")c&&(f.g=c+"."+f.g),Is(f,f.s);else{var E=u.location;f=E.protocol,c=c?c+"."+E.hostname:E.hostname,E=+E.port;var R=new xe(null);f&&Ts(R,f),c&&(R.g=c),E&&Is(R,E),h&&(R.l=h),f=R}return h=o.D,c=o.ya,h&&c&&nt(f,h,c),nt(f,"VER",o.la),fr(o,f),f}function Rl(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new it(new cr({eb:h})):new it(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function bl(){}r=bl.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Vs(){}Vs.prototype.g=function(o,c){return new bt(o,c)};function bt(o,c){yt.call(this),this.g=new pl(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!j(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new sn(this)}x(bt,yt),bt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},bt.prototype.close=function(){Do(this.g)},bt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=vo(o),o=h);c.i.push(new Om(c.Ya++,o)),c.G==3&&bs(c)},bt.prototype.N=function(){this.g.l=null,delete this.j,Do(this.g),delete this.g,bt.aa.N.call(this)};function Pl(o){Io.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}x(Pl,Io);function Vl(){Eo.call(this),this.status=1}x(Vl,Eo);function sn(o){this.g=o}x(sn,bl),sn.prototype.ua=function(){It(this.g,"a")},sn.prototype.ta=function(o){It(this.g,new Pl(o))},sn.prototype.sa=function(o){It(this.g,new Vl)},sn.prototype.ra=function(){It(this.g,"b")},Vs.prototype.createWebChannel=Vs.prototype.g,bt.prototype.send=bt.prototype.o,bt.prototype.open=bt.prototype.m,bt.prototype.close=bt.prototype.close,$o=Zt.createWebChannelTransport=function(){return new Vs},zo=Zt.getStatEventTarget=function(){return ys()},jo=Zt.Event=Ve,Ds=Zt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},_s.NO_ERROR=0,_s.TIMEOUT=8,_s.HTTP_ERROR=6,yr=Zt.ErrorCode=_s,Gc.COMPLETE="complete",Bo=Zt.EventType=Gc,Uc.EventType=er,er.OPEN="a",er.CLOSE="b",er.ERROR="c",er.MESSAGE="d",yt.prototype.listen=yt.prototype.K,an=Zt.WebChannel=Uc,tg=Zt.FetchXmlHttpFactory=cr,it.prototype.listenOnce=it.prototype.L,it.prototype.getLastError=it.prototype.Ka,it.prototype.getLastErrorCode=it.prototype.Ba,it.prototype.getStatus=it.prototype.Z,it.prototype.getResponseJson=it.prototype.Oa,it.prototype.getResponseText=it.prototype.oa,it.prototype.send=it.prototype.ea,it.prototype.setWithCredentials=it.prototype.Ha,Uo=Zt.XhrIo=it}).apply(typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{});var th="@firebase/firestore",eh="4.7.9";var ft=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};ft.UNAUTHENTICATED=new ft(null),ft.GOOGLE_CREDENTIALS=new ft("google-credentials-uid"),ft.FIRST_PARTY=new ft("first-party-uid"),ft.MOCK_USER=new ft("mock-user");var Gn="11.4.0";var Qe=new ql("@firebase/firestore");function mn(){return Qe.logLevel}function V(r,...t){if(Qe.logLevel<=Bt.DEBUG){let e=t.map(Hu);Qe.debug(`Firestore (${Gn}): ${r}`,...e)}}function ot(r,...t){if(Qe.logLevel<=Bt.ERROR){let e=t.map(Hu);Qe.error(`Firestore (${Gn}): ${r}`,...e)}}function xr(r,...t){if(Qe.logLevel<=Bt.WARN){let e=t.map(Hu);Qe.warn(`Firestore (${Gn}): ${r}`,...e)}}function Hu(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function M(r="Unexpected state"){let t=`FIRESTORE (${Gn}) INTERNAL ASSERTION FAILED: `+r;throw ot(t),new Error(t)}function q(r,t){r||M()}function L(r,t){return r}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Ol{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var kt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Jo=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Zo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ft.UNAUTHENTICATED))}shutdown(){}};var ta=class{constructor(t){this.t=t,this.currentUser=ft.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0);let n=this.i,s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),i=new kt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new kt,t.enqueueRetryable(()=>s(this.currentUser))};let a=()=>{let l=i;t.enqueueRetryable(()=>C(this,null,function*(){yield l.promise,yield s(this.currentUser)}))},u=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new kt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new Jo(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new ft(t)}},ea=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=ft.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},na=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new ea(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(ft.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Gs=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ra=class{constructor(t,e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,jl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,e){q(this.o===void 0);let n=i=>{i.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let a=i.token!==this.R;return this.R=i.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>n(i))};let s=i=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.A.getImmediate({optional:!0});i?s(i):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Gs(this.V));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new Gs(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function eg(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Ks=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let s=eg(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function En(r,t,e){return r.length===t.length&&r.every((n,s)=>e(n,t[s]))}function fd(r){return r+"\0"}var nh=-62135596800,rh=1e6,at=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*rh);return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new N(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new N(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<nh)throw new N(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new N(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/rh}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds-nh;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new at(0,0))}static max(){return new r(new at(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var sh="__name__",Qs=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&M(),n===void 0?n=t.length-e:n>t.length-e&&M(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let s=0;s<n;s++){let i=r.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return Math.sign(t.length-e.length)}static compareSegments(t,e){let n=r.isNumericId(t),s=r.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?r.extractNumericId(t).compare(r.extractNumericId(e)):t<e?-1:t>e?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Jt.fromString(t.substring(4,t.length-2))}},Z=class r extends Qs{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new N(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(s=>s.length>0))}return new r(e)}static emptyPath(){return new r([])}},ng=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ht=class r extends Qs{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return ng.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===sh}static keyField(){return new r([sh])}static fromServerFormat(t){let e=[],n="",s=0,i=()=>{if(n.length===0)throw new N(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;s<t.length;){let u=t[s];if(u==="\\"){if(s+1===t.length)throw new N(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new N(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(i(),s++)}if(i(),a)throw new N(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var O=class r{constructor(t){this.path=t}static fromPath(t){return new r(Z.fromString(t))}static fromName(t){return new r(Z.fromString(t).popFirst(5))}static empty(){return new r(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Z.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Z.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new Z(t.slice()))}};var An=-1,Sn=class{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}};function sa(r){return r.fields.find(t=>t.kind===2)}function ke(r){return r.fields.filter(t=>t.kind!==2)}Sn.UNKNOWN_ID=-1;var vn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var Dr=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Ft.min())}};function md(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=B.fromTimestamp(n===1e9?new at(e+1,0):new at(e,n));return new Ft(s,O.empty(),t)}function gd(r){return new Ft(r.readTime,r.key,An)}var Ft=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(B.min(),O.empty(),An)}static max(){return new r(B.max(),O.empty(),An)}};function Yu(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var pd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ws=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Re(r){return C(this,null,function*(){if(r.code!==P.FAILED_PRECONDITION||r.message!==pd)throw r;V("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let s=0,i=0,a=!1;t.forEach(u=>{++s,u.next(()=>{++i,a&&i===s&&e()},l=>n(l))}),a=!0,i===s&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(s=>s?r.resolve(s):n());return e}static forEach(t,e){let n=[];return t.forEach((s,i)=>{n.push(e.call(this,s,i))}),this.waitFor(n)}static mapArray(t,e){return new r((n,s)=>{let i=t.length,a=new Array(i),u=0;for(let l=0;l<i;l++){let d=l;e(t[d]).next(m=>{a[d]=m,++u,u===i&&n(a)},m=>s(m))}})}static doWhile(t,e){return new r((n,s)=>{let i=()=>{t()===!0?e().next(()=>{i()},s):n()};i()})}};var Pt="SimpleDb",Hs=class r{static open(t,e,n,s){try{return new r(e,t.transaction(s,n))}catch(i){throw new ze(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.m=new kt,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{e.error?this.m.reject(new ze(t,e.error)):this.m.resolve()},this.transaction.onerror=n=>{let s=Xu(n.target.error);this.m.reject(new ze(t,s))}}get p(){return this.m.promise}abort(t){t&&this.m.reject(t),this.aborted||(V(Pt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}S(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new oa(e)}},Rn=class r{static delete(t){return V(Pt,"Removing database:",t),Oe(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Fl())return!1;if(r.v())return!0;let t=gr(),e=r.C(t),n=0<e&&e<10,s=yd(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static v(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static C(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.O=n,r.C(gr())===12.2&&ot("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}N(t){return C(this,null,function*(){return this.db||(V(Pt,"Opening database:",this.name),this.db=yield new Promise((e,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let a=i.target.result;e(a)},s.onblocked=()=>{n(new ze(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let a=i.target.error;a.name==="VersionError"?n(new N(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new N(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new ze(t,a))},s.onupgradeneeded=i=>{V(Pt,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let a=i.target.result;this.O.B(a,s.transaction,i.oldVersion,this.version).next(()=>{V(Pt,"Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db})}k(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,s){return C(this,null,function*(){let i=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.N(t);let u=Hs.open(this.db,t,i?"readonly":"readwrite",n),l=s(u).next(d=>(u.S(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return l.catch(()=>{}),yield u.p,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(V(Pt,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function yd(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var ia=class{constructor(t){this.q=t,this.$=!1,this.K=null}get isDone(){return this.$}get U(){return this.K}set cursor(t){this.q=t}done(){this.$=!0}W(t){this.K=t}delete(){return Oe(this.q.delete())}},ze=class extends N{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function be(r){return r.name==="IndexedDbTransactionError"}var oa=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(V(Pt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(V(Pt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Oe(n)}add(t){return V(Pt,"ADD",this.store.name,t,t),Oe(this.store.add(t))}get(t){return Oe(this.store.get(t)).next(e=>(e===void 0&&(e=null),V(Pt,"GET",this.store.name,t,e),e))}delete(t){return V(Pt,"DELETE",this.store.name,t),Oe(this.store.delete(t))}count(){return V(Pt,"COUNT",this.store.name),Oe(this.store.count())}G(t,e){let n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(n.range);return new S((a,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{a(l.target.result)}})}{let i=this.cursor(n),a=[];return this.j(i,(u,l)=>{a.push(l)}).next(()=>a)}}H(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}J(t,e){V(Pt,"DELETE ALL",this.store.name);let n=this.options(t,e);n.Y=!1;let s=this.cursor(n);return this.j(s,(i,a,u)=>u.delete())}Z(t,e){let n;e?n=t:(n={},e=t);let s=this.cursor(n);return this.j(s,e)}X(t){let e=this.cursor({});return new S((n,s)=>{e.onerror=i=>{let a=Xu(i.target.error);s(a)},e.onsuccess=i=>{let a=i.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}j(t,e){let n=[];return new S((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void s();let l=new ia(u),d=e(u.primaryKey,u.value,l);if(d instanceof S){let m=d.catch(g=>(l.done(),S.reject(g)));n.push(m)}l.isDone?s():l.U===null?u.continue():u.continue(l.U)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.Y?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Oe(r){return new S((t,e)=>{r.onsuccess=n=>{let s=n.target.result;t(s)},r.onerror=n=>{let s=Xu(n.target.error);e(s)}})}var ih=!1;function Xu(r){let t=Rn.C(gr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ih||(ih=!0,setTimeout(()=>{throw n},0)),n}}return r}var Ar="IndexBackfiller",aa=class{constructor(t,e){this.asyncQueue=t,this.ee=e,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}te(t){V(Ar,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>C(this,null,function*(){this.task=null;try{let e=yield this.ee.ne();V(Ar,`Documents written: ${e}`)}catch(e){be(e)?V(Ar,"Ignoring IndexedDB error during index backfill: ",e):yield Re(e)}yield this.te(6e4)}))}},ua=class{constructor(t,e){this.localStore=t,this.persistence=e}ne(t=50){return C(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.re(e,t))})}re(t,e){let n=new Set,s=e,i=!0;return S.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return V(Ar,`Processing collection: ${a}`),this.ie(t,a,s).next(u=>{s-=u,n.add(a)});i=!1})).next(()=>e-s)}ie(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next(i=>{let a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.se(s,i)).next(u=>(V(Ar,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}se(t,e){let n=t;return e.changes.forEach((s,i)=>{let a=gd(i);Yu(a,n)>0&&(n=a)}),new Ft(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ct=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.oe(s),this._e=s=>n.writeSequenceNumber(s))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this._e&&this._e(e),e}}r.ae=-1;return r})(),$e=-1;function Hi(r){return r==null}function Nr(r){return r===0&&1/r==-1/0}function _d(r){return typeof r=="number"&&Number.isInteger(r)&&!Nr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var Ys="";function Tt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=oh(t)),t=rg(r.get(e),t);return oh(t)}function rg(r,t){let e=t,n=r.length;for(let s=0;s<n;s++){let i=r.charAt(s);switch(i){case"\0":e+="";break;case Ys:e+="";break;default:e+=i}}return e}function oh(r){return r+Ys+""}function zt(r){let t=r.length;if(q(t>=2),t===2)return q(r.charAt(0)===Ys&&r.charAt(1)===""),Z.emptyPath();let e=t-2,n=[],s="";for(let i=0;i<t;){let a=r.indexOf(Ys,i);switch((a<0||a>e)&&M(),r.charAt(a+1)){case"":let u=r.substring(i,a),l;s.length===0?l=u:(s+=u,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:M()}i=a+2}return new Z(n)}var Fe="remoteDocuments",us="owner",un="owner",kr="mutationQueues",sg="userId",Lt="mutations",ah="batchId",Ue="userMutationsIndex",uh=["userId","batchId"];function Ls(r,t){return[r,Tt(t)]}function wd(r,t,e){return[r,Tt(t),e]}var ig={},bn="documentMutations",Xs="remoteDocumentsV14",og=["prefixPath","collectionGroup","readTime","documentId"],qs="documentKeyIndex",ag=["prefixPath","collectionGroup","documentId"],vd="collectionGroupIndex",ug=["collectionGroup","readTime","prefixPath","documentId"],Fr="remoteDocumentGlobal",ca="remoteDocumentGlobalKey",Pn="targets",Td="queryTargetsIndex",cg=["canonicalId","targetId"],Vn="targetDocuments",lg=["targetId","path"],Ju="documentTargetsIndex",hg=["path","targetId"],Js="targetGlobalKey",Ge="targetGlobal",Or="collectionParents",dg=["collectionId","parent"],Cn="clientMetadata",fg="clientId",Yi="bundles",mg="bundleId",Xi="namedQueries",gg="name",Zu="indexConfiguration",pg="indexId",la="collectionGroupIndex",yg="collectionGroup",Zs="indexState",_g=["indexId","uid"],Id="sequenceNumberIndex",wg=["uid","sequenceNumber"],ti="indexEntries",vg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ed="documentKeyIndex",Tg=["indexId","uid","orderedDocumentKey"],Ji="documentOverlays",Ig=["userId","collectionPath","documentId"],ha="collectionPathOverlayIndex",Eg=["userId","collectionPath","largestBatchId"],Ad="collectionGroupOverlayIndex",Ag=["userId","collectionGroup","largestBatchId"],tc="globals",Sg="name",Sd=[kr,Lt,bn,Fe,Pn,us,Ge,Vn,Cn,Fr,Or,Yi,Xi],Rg=[...Sd,Ji],Rd=[kr,Lt,bn,Xs,Pn,us,Ge,Vn,Cn,Fr,Or,Yi,Xi,Ji],bd=Rd,ec=[...bd,Zu,Zs,ti],bg=ec,Pg=[...ec,tc];var Mr=class extends Ws{constructor(t,e){super(),this.ue=t,this.currentSequenceNumber=e}};function dt(r,t){let e=L(r);return Rn.M(e.ue,t)}function ch(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function tn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Pd(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var rt=class r{constructor(t,e){this.comparator=t,this.root=e||Gt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wn(this.root,t,this.comparator,!1)}getReverseIterator(){return new wn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wn(this.root,t,this.comparator,!0)}},wn=class{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Gt=class r{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??r.RED,this.left=s??r.EMPTY,this.right=i??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new r(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this,i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return r.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();let t=this.left.check();if(t!==this.right.check())throw M();return t+(this.isRed()?0:1)}};Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Gt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var tt=class r{constructor(t){this.comparator=t,this.data=new rt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ei(this.data.getIterator())}getIteratorFrom(t){return new ei(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},ei=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function cn(r){return r.hasNext()?r.getNext():void 0}var qt=class r{constructor(t){this.fields=t,t.sort(ht.comparator)}static empty(){return new r([])}unionWith(t){let e=new tt(ht.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return En(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var ni=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var lt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ni("Invalid base64 string: "+i):i}}(t);return new r(e)}static fromUint8Array(t){let e=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};lt.EMPTY_BYTE_STRING=new lt("");var Vg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ee(r){if(q(!!r),typeof r=="string"){let t=0,e=Vg.exec(r);if(q(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function ne(r){return typeof r=="string"?lt.fromBase64String(r):lt.fromUint8Array(r)}var Vd="server_timestamp",Cd="__type__",xd="__previous_value__",Dd="__local_write_time__";function nc(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Cd])===null||e===void 0?void 0:e.stringValue)===Vd}function Zi(r){let t=r.mapValue.fields[xd];return nc(t)?Zi(t):t}function Lr(r){let t=ee(r.mapValue.fields[Dd].timestampValue);return new at(t.seconds,t.nanos)}var da=class{constructor(t,e,n,s,i,a,u,l,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},ri="(default)",xn=class r{constructor(t,e){this.projectId=t,this.database=e||ri}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===ri}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var rc="__type__",Nd="__max__",fe={mapValue:{fields:{__type__:{stringValue:Nd}}}},sc="__vector__",Dn="value",Us={nullValue:"NULL_VALUE"};function ge(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?nc(r)?4:kd(r)?9007199254740991:to(r)?10:11:M()}function Qt(r,t){if(r===t)return!0;let e=ge(r);if(e!==ge(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Lr(r).isEqual(Lr(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let a=ee(s.timestampValue),u=ee(i.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(s,i){return ne(s.bytesValue).isEqual(ne(i.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(s,i){return st(s.geoPointValue.latitude)===st(i.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(i.geoPointValue.longitude)}(r,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return st(s.integerValue)===st(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let a=st(s.doubleValue),u=st(i.doubleValue);return a===u?Nr(a)===Nr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return En(r.arrayValue.values||[],t.arrayValue.values||[],Qt);case 10:case 11:return function(s,i){let a=s.mapValue.fields||{},u=i.mapValue.fields||{};if(ch(a)!==ch(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!Qt(a[l],u[l])))return!1;return!0}(r,t);default:return M()}}function qr(r,t){return(r.values||[]).find(e=>Qt(e,t))!==void 0}function pe(r,t){if(r===t)return 0;let e=ge(r),n=ge(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(i,a){let u=st(i.integerValue||i.doubleValue),l=st(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return lh(r.timestampValue,t.timestampValue);case 4:return lh(Lr(r),Lr(t));case 5:return z(r.stringValue,t.stringValue);case 6:return function(i,a){let u=ne(i),l=ne(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(i,a){let u=i.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let m=z(u[d],l[d]);if(m!==0)return m}return z(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(i,a){let u=z(st(i.latitude),st(a.latitude));return u!==0?u:z(st(i.longitude),st(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return hh(r.arrayValue,t.arrayValue);case 10:return function(i,a){var u,l,d,m;let g=i.fields||{},T=a.fields||{},b=(u=g[Dn])===null||u===void 0?void 0:u.arrayValue,x=(l=T[Dn])===null||l===void 0?void 0:l.arrayValue,k=z(((d=b?.values)===null||d===void 0?void 0:d.length)||0,((m=x?.values)===null||m===void 0?void 0:m.length)||0);return k!==0?k:hh(b,x)}(r.mapValue,t.mapValue);case 11:return function(i,a){if(i===fe.mapValue&&a===fe.mapValue)return 0;if(i===fe.mapValue)return 1;if(a===fe.mapValue)return-1;let u=i.fields||{},l=Object.keys(u),d=a.fields||{},m=Object.keys(d);l.sort(),m.sort();for(let g=0;g<l.length&&g<m.length;++g){let T=z(l[g],m[g]);if(T!==0)return T;let b=pe(u[l[g]],d[m[g]]);if(b!==0)return b}return z(l.length,m.length)}(r.mapValue,t.mapValue);default:throw M()}}function lh(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ee(r),n=ee(t),s=z(e.seconds,n.seconds);return s!==0?s:z(e.nanos,n.nanos)}function hh(r,t){let e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){let i=pe(e[s],n[s]);if(i)return i}return z(e.length,n.length)}function Nn(r){return fa(r)}function fa(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ee(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return ne(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",s=!0;for(let i of e.values||[])s?s=!1:n+=",",n+=fa(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),s="{",i=!0;for(let a of n)i?i=!1:s+=",",s+=`${a}:${fa(e.fields[a])}`;return s+"}"}(r.mapValue):M()}function Bs(r){switch(ge(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Zi(r);return t?16+Bs(t):16;case 5:return 2*r.stringValue.length;case 6:return ne(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,i)=>s+Bs(i),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return tn(n.fields,(i,a)=>{s+=i.length+Bs(a)}),s}(r.mapValue);default:throw M()}}function Ur(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function ma(r){return!!r&&"integerValue"in r}function Br(r){return!!r&&"arrayValue"in r}function dh(r){return!!r&&"nullValue"in r}function fh(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function js(r){return!!r&&"mapValue"in r}function to(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{})[rc])===null||e===void 0?void 0:e.stringValue)===sc}function Sr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return tn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Sr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Sr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function kd(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Nd}var Fd={mapValue:{fields:{[rc]:{stringValue:sc},[Dn]:{arrayValue:{}}}}};function Cg(r){return"nullValue"in r?Us:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Ur(xn.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?to(r)?Fd:{mapValue:{}}:M()}function xg(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Ur(xn.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Fd:"mapValue"in r?to(r)?{mapValue:{}}:fe:M()}function mh(r,t){let e=pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function gh(r,t){let e=pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Vt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!js(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Sr(e)}setAll(t){let e=ht.emptyPath(),n={},s=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=u.popLast()}a?n[u.lastSegment()]=Sr(a):s.push(u.lastSegment())});let i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){let e=this.field(t.popLast());js(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Qt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];js(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){tn(e,(s,i)=>t[s]=i);for(let s of n)delete t[s]}clone(){return new r(Sr(this.value))}};function Od(r){let t=[];return tn(r.fields,(e,n)=>{let s=new ht([e]);if(js(n)){let i=Od(n.mapValue).fields;if(i.length===0)t.push(s);else for(let a of i)t.push(s.child(a))}else t.push(s)}),new qt(t)}var gt=class r{constructor(t,e,n,s,i,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,B.min(),B.min(),B.min(),Vt.empty(),0)}static newFoundDocument(t,e,n,s){return new r(t,1,e,B.min(),n,s,0)}static newNoDocument(t,e){return new r(t,2,e,B.min(),B.min(),Vt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,B.min(),B.min(),Vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ye=class{constructor(t,e){this.position=t,this.inclusive=e}};function ph(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){let i=t[s],a=r.position[s];if(i.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=pe(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function yh(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Qt(r.position[e],t.position[e]))return!1;return!0}var We=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Dg(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var si=class{},Q=class r extends si{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new ya(t,e,n):e==="array-contains"?new va(t,n):e==="in"?new ii(t,n):e==="not-in"?new Ta(t,n):e==="array-contains-any"?new Ia(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new _a(t,n):new wa(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(pe(e,this.value)):e!==null&&ge(this.value)===ge(e)&&this.matchesComparison(pe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},J=class r extends si{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new r(t,e)}matches(t){return kn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}};function kn(r){return r.op==="and"}function ga(r){return r.op==="or"}function ic(r){return Md(r)&&kn(r)}function Md(r){for(let t of r.filters)if(t instanceof J)return!1;return!0}function pa(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+Nn(r.value);if(ic(r))return r.filters.map(t=>pa(t)).join(",");{let t=r.filters.map(e=>pa(e)).join(",");return`${r.op}(${t})`}}function Ld(r,t){return r instanceof Q?function(n,s){return s instanceof Q&&n.op===s.op&&n.field.isEqual(s.field)&&Qt(n.value,s.value)}(r,t):r instanceof J?function(n,s){return s instanceof J&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,u)=>i&&Ld(a,s.filters[u]),!0):!1}(r,t):void M()}function qd(r,t){let e=r.filters.concat(t);return J.create(e,r.op)}function Ud(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${Nn(e.value)}`}(r):r instanceof J?function(e){return e.op.toString()+" {"+e.getFilters().map(Ud).join(" ,")+"}"}(r):"Filter"}var ya=class extends Q{constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){let e=O.comparator(t.key,this.key);return this.matchesComparison(e)}},_a=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Bd("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},wa=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Bd("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Bd(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}var va=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Br(e)&&qr(e.arrayValue,this.value)}},ii=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&qr(this.value.arrayValue,e)}},Ta=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!qr(this.value.arrayValue,e)}},Ia=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Br(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>qr(this.value.arrayValue,n))}};var Ea=class{constructor(t,e=null,n=[],s=[],i=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=u,this.le=null}};function Aa(r,t=null,e=[],n=[],s=null,i=null,a=null){return new Ea(r,t,e,n,s,i,a)}function He(r){let t=L(r);if(t.le===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>pa(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Hi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Nn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Nn(n)).join(",")),t.le=e}return t.le}function cs(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Dg(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Ld(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!yh(r.startAt,t.startAt)&&yh(r.endAt,t.endAt)}function oi(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ai(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function _h(r,t,e){let n=Us,s=!0;for(let i of ai(r,t)){let a=Us,u=!0;switch(i.op){case"<":case"<=":a=Cg(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,u=!1;break;case"!=":case"not-in":a=Us}mh({value:n,inclusive:s},{value:a,inclusive:u})<0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];mh({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function wh(r,t,e){let n=fe,s=!0;for(let i of ai(r,t)){let a=fe,u=!0;switch(i.op){case">=":case">":a=xg(i.value),u=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,u=!1;break;case"!=":case"not-in":a=fe}gh({value:n,inclusive:s},{value:a,inclusive:u})>0&&(n=a,s=u)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){let a=e.position[i];gh({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}var _e=class{constructor(t,e=null,n=[],s=[],i=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=u,this.endAt=l,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}};function jd(r,t,e,n,s,i,a,u){return new _e(r,t,e,n,s,i,a,u)}function ls(r){return new _e(r)}function vh(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function zd(r){return r.collectionGroup!==null}function Rr(r){let t=L(r);if(t.he===null){t.he=[];let e=new Set;for(let i of t.explicitOrderBy)t.he.push(i),e.add(i.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new tt(ht.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.he.push(new We(i,n))}),e.has(ht.keyField().canonicalString())||t.he.push(new We(ht.keyField(),n))}return t.he}function Dt(r){let t=L(r);return t.Pe||(t.Pe=Ng(t,Rr(r))),t.Pe}function Ng(r,t){if(r.limitType==="F")return Aa(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new We(s.field,i)});let e=r.endAt?new ye(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new ye(r.startAt.position,r.startAt.inclusive):null;return Aa(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Sa(r,t){let e=r.filters.concat([t]);return new _e(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Ra(r,t,e){return new _e(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function eo(r,t){return cs(Dt(r),Dt(t))&&r.limitType===t.limitType}function $d(r){return`${He(Dt(r))}|lt:${r.limitType}`}function gn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>Ud(s)).join(", ")}]`),Hi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>Nn(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>Nn(s)).join(",")),`Target(${n})`}(Dt(r))}; limitType=${r.limitType})`}function hs(r,t){return t.isFoundDocument()&&function(n,s){let i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):O.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,t)&&function(n,s){for(let i of Rr(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,t)&&function(n,s){for(let i of n.filters)if(!i.matches(s))return!1;return!0}(r,t)&&function(n,s){return!(n.startAt&&!function(a,u,l){let d=ph(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,Rr(n),s)||n.endAt&&!function(a,u,l){let d=ph(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,Rr(n),s))}(r,t)}function Gd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Kd(r){return(t,e)=>{let n=!1;for(let s of Rr(r)){let i=kg(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function kg(r,t,e){let n=r.field.isKeyField()?O.comparator(t.key,e.key):function(i,a,u){let l=a.data.field(i),d=u.data.field(i);return l!==null&&d!==null?pe(l,d):M()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return M()}}var Ut=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){tn(this.inner,(e,n)=>{for(let[s,i]of n)t(s,i)})}isEmpty(){return Pd(this.inner)}size(){return this.innerSize}};var Fg=new rt(O.comparator);function xt(){return Fg}var Qd=new rt(O.comparator);function Ir(...r){let t=Qd;for(let e of r)t=t.insert(e.key,e);return t}function Wd(r){let t=Qd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function $t(){return br()}function Hd(){return br()}function br(){return new Ut(r=>r.toString(),(r,t)=>r.isEqual(t))}var Og=new rt(O.comparator),Mg=new tt(O.comparator);function K(...r){let t=Mg;for(let e of r)t=t.add(e);return t}var Lg=new tt(z);function oc(){return Lg}function ac(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nr(t)?"-0":t}}function Yd(r){return{integerValue:""+r}}function qg(r,t){return _d(t)?Yd(t):ac(r,t)}var Fn=class{constructor(){this._=void 0}};function Ug(r,t,e){return r instanceof we?function(s,i){let a={fields:{[Cd]:{stringValue:Vd},[Dd]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&nc(i)&&(i=Zi(i)),i&&(a.fields[xd]=i),{mapValue:a}}(e,t):r instanceof ve?Jd(r,t):r instanceof Te?Zd(r,t):function(s,i){let a=Xd(s,i),u=Th(a)+Th(s.Ie);return ma(a)&&ma(s.Ie)?Yd(u):ac(s.serializer,u)}(r,t)}function Bg(r,t,e){return r instanceof ve?Jd(r,t):r instanceof Te?Zd(r,t):e}function Xd(r,t){return r instanceof Ye?function(n){return ma(n)||function(i){return!!i&&"doubleValue"in i}(n)}(t)?t:{integerValue:0}:null}var we=class extends Fn{},ve=class extends Fn{constructor(t){super(),this.elements=t}};function Jd(r,t){let e=tf(t);for(let n of r.elements)e.some(s=>Qt(s,n))||e.push(n);return{arrayValue:{values:e}}}var Te=class extends Fn{constructor(t){super(),this.elements=t}};function Zd(r,t){let e=tf(t);for(let n of r.elements)e=e.filter(s=>!Qt(s,n));return{arrayValue:{values:e}}}var Ye=class extends Fn{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function Th(r){return st(r.integerValue||r.doubleValue)}function tf(r){return Br(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var ui=class{constructor(t,e){this.field=t,this.transform=e}};function jg(r,t){return r.field.isEqual(t.field)&&function(n,s){return n instanceof ve&&s instanceof ve||n instanceof Te&&s instanceof Te?En(n.elements,s.elements,Qt):n instanceof Ye&&s instanceof Ye?Qt(n.Ie,s.Ie):n instanceof we&&s instanceof we}(r.transform,t.transform)}var ba=class{constructor(t,e){this.version=t,this.transformResults=e}},Nt=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function zs(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var On=class{};function ef(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Mn(r.key,Nt.none()):new Ie(r.key,r.data,Nt.none());{let e=r.data,n=Vt.empty(),s=new tt(ht.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new Wt(r.key,n,new qt(s.toArray()),Nt.none())}}function zg(r,t,e){r instanceof Ie?function(s,i,a){let u=s.value.clone(),l=Eh(s.fieldTransforms,i,a.transformResults);u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Wt?function(s,i,a){if(!zs(s.precondition,i))return void i.convertToUnknownDocument(a.version);let u=Eh(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(nf(s)),l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Pr(r,t,e,n){return r instanceof Ie?function(i,a,u,l){if(!zs(i.precondition,a))return u;let d=i.value.clone(),m=Ah(i.fieldTransforms,l,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Wt?function(i,a,u,l){if(!zs(i.precondition,a))return u;let d=Ah(i.fieldTransforms,l,a),m=a.data;return m.setAll(nf(i)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),u===null?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(i,a,u){return zs(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function $g(r,t){let e=null;for(let n of r.fieldTransforms){let s=t.data.field(n.field),i=Xd(n.transform,s||null);i!=null&&(e===null&&(e=Vt.empty()),e.set(n.field,i))}return e||null}function Ih(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&En(n,s,(i,a)=>jg(i,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ie=class extends On{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Wt=class extends On{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function nf(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Eh(r,t,e){let n=new Map;q(r.length===e.length);for(let s=0;s<e.length;s++){let i=r[s],a=i.transform,u=t.data.field(i.field);n.set(i.field,Bg(a,u,e[s]))}return n}function Ah(r,t,e){let n=new Map;for(let s of r){let i=s.transform,a=e.data.field(s.field);n.set(s.field,Ug(i,a,t))}return n}var Mn=class extends On{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ci=class extends On{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var jr=class{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&zg(i,t,n[s])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Pr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Pr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Hd();return this.mutations.forEach(s=>{let i=t.get(s.key),a=i.overlayedDocument,u=this.applyToLocalView(a,i.mutatedFields);u=e.has(s.key)?null:u;let l=ef(a,u);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&En(this.mutations,t.mutations,(e,n)=>Ih(e,n))&&En(this.baseMutations,t.baseMutations,(e,n)=>Ih(e,n))}},Pa=class r{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){q(t.mutations.length===n.length);let s=function(){return Og}(),i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new r(t,e,n,s)}};var zr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Va=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var ut,H;function Gg(r){switch(r){case P.OK:return M();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M()}}function rf(r){if(r===void 0)return ot("GRPC error has no .code"),P.UNKNOWN;switch(r){case ut.OK:return P.OK;case ut.CANCELLED:return P.CANCELLED;case ut.UNKNOWN:return P.UNKNOWN;case ut.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ut.INTERNAL:return P.INTERNAL;case ut.UNAVAILABLE:return P.UNAVAILABLE;case ut.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ut.NOT_FOUND:return P.NOT_FOUND;case ut.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ut.ABORTED:return P.ABORTED;case ut.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ut.DATA_LOSS:return P.DATA_LOSS;default:return M()}}(H=ut||(ut={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var Sh=null;function Kg(){return new TextEncoder}var Qg=new Jt([4294967295,4294967295],0);function Rh(r){let t=Kg().encode(r),e=new qo;return e.update(t),new Uint8Array(e.digest())}function bh(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Jt([e,n],0),new Jt([s,i],0)]}var Ca=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Be(`Invalid padding: ${e}`);if(n<0)throw new Be(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Be(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Be(`Invalid padding when bitmap length is 0: ${e}`);this.Ee=8*t.length-e,this.de=Jt.fromNumber(this.Ee)}Ae(t,e,n){let s=t.add(e.multiply(Jt.fromNumber(n)));return s.compare(Qg)===1&&(s=new Jt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;let e=Rh(t),[n,s]=bh(e);for(let i=0;i<this.hashCount;i++){let a=this.Ae(n,s,i);if(!this.Re(a))return!1}return!0}static create(t,e,n){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new r(i,s,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ee===0)return;let e=Rh(t),[n,s]=bh(e);for(let i=0;i<this.hashCount;i++){let a=this.Ae(n,s,i);this.Ve(a)}}Ve(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},Be=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $r=class r{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let s=new Map;return s.set(t,Gr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(B.min(),s,new rt(z),xt(),K())}},Gr=class r{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var Tn=class{constructor(t,e,n,s){this.me=t,this.removedTargetIds=e,this.key=n,this.fe=s}},li=class{constructor(t,e){this.targetId=t,this.ge=e}},hi=class{constructor(t,e,n=lt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}},di=class{constructor(){this.pe=0,this.ye=Ph(),this.we=lt.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=K(),e=K(),n=K();return this.ye.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:M()}}),new Gr(this.we,this.be,t,e,n)}Me(){this.Se=!1,this.ye=Ph()}xe(t,e){this.Se=!0,this.ye=this.ye.insert(t,e)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,q(this.pe>=0)}Le(){this.Se=!0,this.be=!0}},xa=class{constructor(t){this.ke=t,this.qe=new Map,this.Qe=xt(),this.$e=Ns(),this.Ke=Ns(),this.Ue=new rt(z)}We(t){for(let e of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(e,t.fe):this.ze(e,t.key,t.fe);for(let e of t.removedTargetIds)this.ze(e,t.key,t.fe)}je(t){this.forEachTarget(t,e=>{let n=this.He(e);switch(t.state){case 0:this.Je(e)&&n.Ce(t.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(t.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(e);break;case 3:this.Je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),n.Ce(t.resumeToken));break;default:M()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.qe.forEach((n,s)=>{this.Je(s)&&e(s)})}Ze(t){let e=t.targetId,n=t.ge.count,s=this.Xe(e);if(s){let i=s.target;if(oi(i))if(n===0){let a=new O(i.path);this.ze(e,a,gt.newNoDocument(a,B.min()))}else q(n===1);else{let a=this.et(e);if(a!==n){let u=this.tt(t),l=u?this.nt(u,t,a):1;if(l!==0){this.Ye(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(e,d)}Sh?.rt(function(m,g,T,b,x){var k,D,$,j,U,W;let X={localCacheCount:m,existenceFilterCount:g.count,databaseId:T.database,projectId:T.projectId},G=g.unchangedNames;return G&&(X.bloomFilter={applied:x===0,hashCount:(k=G?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=($=(D=G?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&j!==void 0?j:0,padding:(W=(U=G?.bits)===null||U===void 0?void 0:U.padding)!==null&&W!==void 0?W:0,mightContain:w=>{var p;return(p=b?.mightContain(w))!==null&&p!==void 0&&p}}),X}(a,t.ge,this.ke.it(),u,l))}}}}tt(t){let e=t.ge.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e,a,u;try{a=ne(n).toUint8Array()}catch(l){if(l instanceof ni)return xr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Ca(a,s,i)}catch(l){return xr(l instanceof Be?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ee===0?null:u}nt(t,e,n){return e.ge.count===n-this.st(t,e.targetId)?0:2}st(t,e){let n=this.ke.getRemoteKeysForTarget(e),s=0;return n.forEach(i=>{let a=this.ke.it(),u=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(u)||(this.ze(e,i,null),s++)}),s}ot(t){let e=new Map;this.qe.forEach((i,a)=>{let u=this.Xe(a);if(u){if(i.current&&oi(u.target)){let l=new O(u.target.path);this._t(l).has(a)||this.ut(a,l)||this.ze(a,l,gt.newNoDocument(l,t))}i.ve&&(e.set(a,i.Fe()),i.Me())}});let n=K();this.Ke.forEach((i,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Xe(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(i))}),this.Qe.forEach((i,a)=>a.setReadTime(t));let s=new $r(t,e,this.Ue,this.Qe,n);return this.Qe=xt(),this.$e=Ns(),this.Ke=Ns(),this.Ue=new rt(z),s}Ge(t,e){if(!this.Je(t))return;let n=this.ut(t,e.key)?2:0;this.He(t).xe(e.key,n),this.Qe=this.Qe.insert(e.key,e),this.$e=this.$e.insert(e.key,this._t(e.key).add(t)),this.Ke=this.Ke.insert(e.key,this.ct(e.key).add(t))}ze(t,e,n){if(!this.Je(t))return;let s=this.He(t);this.ut(t,e)?s.xe(e,1):s.Oe(e),this.Ke=this.Ke.insert(e,this.ct(e).delete(t)),this.Ke=this.Ke.insert(e,this.ct(e).add(t)),n&&(this.Qe=this.Qe.insert(e,n))}removeTarget(t){this.qe.delete(t)}et(t){let e=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let e=this.qe.get(t);return e||(e=new di,this.qe.set(t,e)),e}ct(t){let e=this.Ke.get(t);return e||(e=new tt(z),this.Ke=this.Ke.insert(t,e)),e}_t(t){let e=this.$e.get(t);return e||(e=new tt(z),this.$e=this.$e.insert(t,e)),e}Je(t){let e=this.Xe(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}Xe(t){let e=this.qe.get(t);return e&&e.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new di),this.ke.getRemoteKeysForTarget(t).forEach(e=>{this.ze(t,e,null)})}ut(t,e){return this.ke.getRemoteKeysForTarget(t).has(e)}};function Ns(){return new rt(O.comparator)}function Ph(){return new rt(O.comparator)}var Wg={asc:"ASCENDING",desc:"DESCENDING"},Hg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yg={and:"AND",or:"OR"},Da=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Na(r,t){return r.useProto3Json||Hi(t)?t:{value:t}}function Ln(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function sf(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Xg(r,t){return Ln(r,t.toTimestamp())}function At(r){return q(!!r),B.fromTimestamp(function(e){let n=ee(e);return new at(n.seconds,n.nanos)}(r))}function uc(r,t){return ka(r,t).canonicalString()}function ka(r,t){let e=function(s){return new Z(["projects",s.projectId,"databases",s.database])}(r).child("documents");return t===void 0?e:e.child(t)}function of(r){let t=Z.fromString(r);return q(gf(t)),t}function fi(r,t){return uc(r.databaseId,t.path)}function Ke(r,t){let e=of(t);if(e.get(1)!==r.databaseId.projectId)throw new N(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new N(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O(cf(e))}function af(r,t){return uc(r.databaseId,t)}function uf(r){let t=of(r);return t.length===4?Z.emptyPath():cf(t)}function Fa(r){return new Z(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function cf(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Vh(r,t,e){return{name:fi(r,t),fields:e.value.mapValue.fields}}function Jg(r,t,e){let n=Ke(r,t.name),s=At(t.updateTime),i=t.createTime?At(t.createTime):B.min(),a=new Vt({mapValue:{fields:t.fields}}),u=gt.newFoundDocument(n,s,i,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Zg(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(d,m){return d.useProto3Json?(q(m===void 0||typeof m=="string"),lt.fromBase64String(m||"")):(q(m===void 0||m instanceof Buffer||m instanceof Uint8Array),lt.fromUint8Array(m||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let m=d.code===void 0?P.UNKNOWN:rf(d.code);return new N(m,d.message||"")}(a);e=new hi(n,s,i,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=Ke(r,n.document.name),i=At(n.document.updateTime),a=n.document.createTime?At(n.document.createTime):B.min(),u=new Vt({mapValue:{fields:n.document.fields}}),l=gt.newFoundDocument(s,i,a,u),d=n.targetIds||[],m=n.removedTargetIds||[];e=new Tn(d,m,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=Ke(r,n.document),i=n.readTime?At(n.readTime):B.min(),a=gt.newNoDocument(s,i),u=n.removedTargetIds||[];e=new Tn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=Ke(r,n.document),i=n.removedTargetIds||[];e=new Tn([],i,s,null)}else{if(!("filter"in t))return M();{t.filter;let n=t.filter;n.targetId;let{count:s=0,unchangedNames:i}=n,a=new Va(s,i),u=n.targetId;e=new li(u,a)}}return e}function mi(r,t){let e;if(t instanceof Ie)e={update:Vh(r,t.key,t.value)};else if(t instanceof Mn)e={delete:fi(r,t.key)};else if(t instanceof Wt)e={update:Vh(r,t.key,t.data),updateMask:ip(t.fieldMask)};else{if(!(t instanceof ci))return M();e={verify:fi(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(i,a){let u=a.transform;if(u instanceof we)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ve)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Te)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ye)return{fieldPath:a.field.canonicalString(),increment:u.Ie};throw M()}(0,n))),t.precondition.isNone||(e.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Xg(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:M()}(r,t.precondition)),e}function Oa(r,t){let e=t.currentDocument?function(i){return i.updateTime!==void 0?Nt.updateTime(At(i.updateTime)):i.exists!==void 0?Nt.exists(i.exists):Nt.none()}(t.currentDocument):Nt.none(),n=t.updateTransforms?t.updateTransforms.map(s=>function(a,u){let l=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),l=new we;else if("appendMissingElements"in u){let m=u.appendMissingElements.values||[];l=new ve(m)}else if("removeAllFromArray"in u){let m=u.removeAllFromArray.values||[];l=new Te(m)}else"increment"in u?l=new Ye(a,u.increment):M();let d=ht.fromServerFormat(u.fieldPath);return new ui(d,l)}(r,s)):[];if(t.update){t.update.name;let s=Ke(r,t.update.name),i=new Vt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new qt(d.map(m=>ht.fromServerFormat(m)))}(t.updateMask);return new Wt(s,i,a,e,n)}return new Ie(s,i,e,n)}if(t.delete){let s=Ke(r,t.delete);return new Mn(s,e)}if(t.verify){let s=Ke(r,t.verify);return new ci(s,e)}return M()}function tp(r,t){return r&&r.length>0?(q(t!==void 0),r.map(e=>function(s,i){let a=s.updateTime?At(s.updateTime):At(i);return a.isEqual(B.min())&&(a=At(i)),new ba(a,s.transformResults||[])}(e,t))):[]}function lf(r,t){return{documents:[af(r,t.path)]}}function hf(r,t){let e={structuredQuery:{}},n=t.path,s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=af(r,s);let i=function(d){if(d.length!==0)return mf(J.create(d,"and"))}(t.filters);i&&(e.structuredQuery.where=i);let a=function(d){if(d.length!==0)return d.map(m=>function(T){return{field:pn(T.field),direction:np(T.dir)}}(m))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Na(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ht:e,parent:s}}function df(r){let t=uf(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,s=null;if(n>0){q(n===1);let m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let i=[];e.where&&(i=function(g){let T=ff(g);return T instanceof J&&ic(T)?T.getFilters():[T]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(T=>function(x){return new We(yn(x.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(T))}(e.orderBy));let u=null;e.limit&&(u=function(g){let T;return T=typeof g=="object"?g.value:g,Hi(T)?null:T}(e.limit));let l=null;e.startAt&&(l=function(g){let T=!!g.before,b=g.values||[];return new ye(b,T)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let T=!g.before,b=g.values||[];return new ye(b,T)}(e.endAt)),jd(t,s,a,i,u,"F",l,d)}function ep(r,t){let e=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function ff(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=yn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=yn(e.unaryFilter.field);return Q.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=yn(e.unaryFilter.field);return Q.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=yn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(r):r.fieldFilter!==void 0?function(e){return Q.create(yn(e.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return J.create(e.compositeFilter.filters.map(n=>ff(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return M()}}(e.compositeFilter.op))}(r):M()}function np(r){return Wg[r]}function rp(r){return Hg[r]}function sp(r){return Yg[r]}function pn(r){return{fieldPath:r.canonicalString()}}function yn(r){return ht.fromServerFormat(r.fieldPath)}function mf(r){return r instanceof Q?function(e){if(e.op==="=="){if(fh(e.value))return{unaryFilter:{field:pn(e.field),op:"IS_NAN"}};if(dh(e.value))return{unaryFilter:{field:pn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(fh(e.value))return{unaryFilter:{field:pn(e.field),op:"IS_NOT_NAN"}};if(dh(e.value))return{unaryFilter:{field:pn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pn(e.field),op:rp(e.op),value:e.value}}}(r):r instanceof J?function(e){let n=e.getFilters().map(s=>mf(s));return n.length===1?n[0]:{compositeFilter:{op:sp(e.op),filters:n}}}(r):M()}function ip(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function gf(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var qn=class r{constructor(t,e,n,s,i=B.min(),a=B.min(),u=lt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var gi=class{constructor(t){this.Tt=t}};function op(r,t){let e;if(t.document)e=Jg(r.Tt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=O.fromSegments(t.noDocument.path),s=Je(t.noDocument.readTime);e=gt.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return M();{let n=O.fromSegments(t.unknownDocument.path),s=Je(t.unknownDocument.version);e=gt.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime(function(s){let i=new at(s[0],s[1]);return B.fromTimestamp(i)}(t.readTime)),e}function Ch(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:pi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(i,a){return{name:fi(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Ln(i,a.version.toTimestamp()),createTime:Ln(i,a.createTime.toTimestamp())}}(r.Tt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:Xe(t.version)};else{if(!t.isUnknownDocument())return M();n.unknownDocument={path:e.path.toArray(),version:Xe(t.version)}}return n}function pi(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function Xe(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Je(r){let t=new at(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function Me(r,t){let e=(t.baseMutations||[]).map(i=>Oa(r.Tt,i));for(let i=0;i<t.mutations.length-1;++i){let a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){let u=t.mutations[i+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}let n=t.mutations.map(i=>Oa(r.Tt,i)),s=at.fromMillis(t.localWriteTimeMs);return new jr(t.batchId,s,e,n)}function Er(r){let t=Je(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?Je(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){return q(i.documents.length===1),Dt(ls(uf(i.documents[0])))}(r.query):function(i){return Dt(df(i))}(r.query),new qn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,lt.fromBase64String(r.resumeToken))}function pf(r,t){let e=Xe(t.snapshotVersion),n=Xe(t.lastLimboFreeSnapshotVersion),s;s=oi(t.target)?lf(r.Tt,t.target):hf(r.Tt,t.target).ht;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:He(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function yf(r){let t=df({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Ra(t,t.limit,"L"):t}function Go(r,t){return new zr(t.largestBatchId,Oa(r.Tt,t.overlayMutation))}function xh(r,t){let e=t.path.lastSegment();return[r,Tt(t.path.popLast()),e]}function Dh(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:Xe(n.readTime),documentKey:Tt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Ma=class{getBundleMetadata(t,e){return Nh(t).get(e).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:Je(i.createTime),version:i.version}}(n)})}saveBundleMetadata(t,e){return Nh(t).put(function(s){return{bundleId:s.id,createTime:Xe(At(s.createTime)),version:s.version}}(e))}getNamedQuery(t,e){return kh(t).get(e).next(n=>{if(n)return function(i){return{name:i.name,query:yf(i.bundledQuery),readTime:Je(i.readTime)}}(n)})}saveNamedQuery(t,e){return kh(t).put(function(s){return{name:s.name,readTime:Xe(At(s.readTime)),bundledQuery:s.bundledQuery}}(e))}};function Nh(r){return dt(r,Yi)}function kh(r){return dt(r,Xi)}var yi=class r{constructor(t,e){this.serializer=t,this.userId=e}static It(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return _r(t).get(xh(this.userId,e)).next(n=>n?Go(this.serializer,n):null)}getOverlays(t,e){let n=$t();return S.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){let s=[];return n.forEach((i,a)=>{let u=new zr(e,a);s.push(this.Et(t,u))}),S.waitFor(s)}removeOverlaysForBatchId(t,e,n){let s=new Set;e.forEach(a=>s.add(Tt(a.getCollectionPath())));let i=[];return s.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(_r(t).J(ha,u))}),S.waitFor(i)}getOverlaysForCollection(t,e,n){let s=$t(),i=Tt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return _r(t).G(ha,a).next(u=>{for(let l of u){let d=Go(this.serializer,l);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(t,e,n,s){let i=$t(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return _r(t).Z({index:Ad,range:u},(l,d,m)=>{let g=Go(this.serializer,d);i.size()<s||g.largestBatchId===a?(i.set(g.getKey(),g),a=g.largestBatchId):m.done()}).next(()=>i)}Et(t,e){return _r(t).put(function(s,i,a){let[u,l,d]=xh(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:mi(s.Tt,a.mutation)}}(this.serializer,this.userId,e))}};function _r(r){return dt(r,Ji)}var La=class{dt(t){return dt(t,tc)}getSessionToken(t){return this.dt(t).get("sessionToken").next(e=>{let n=e?.value;return n?lt.fromUint8Array(n):lt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.dt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var te=class{constructor(){}At(t,e){this.Rt(t,e),e.Vt()}Rt(t,e){if("nullValue"in t)this.ft(e,5);else if("booleanValue"in t)this.ft(e,10),e.gt(t.booleanValue?1:0);else if("integerValue"in t)this.ft(e,15),e.gt(st(t.integerValue));else if("doubleValue"in t){let n=st(t.doubleValue);isNaN(n)?this.ft(e,13):(this.ft(e,15),Nr(n)?e.gt(0):e.gt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.ft(e,20),typeof n=="string"&&(n=ee(n)),e.yt(`${n.seconds||""}`),e.gt(n.nanos||0)}else if("stringValue"in t)this.wt(t.stringValue,e),this.bt(e);else if("bytesValue"in t)this.ft(e,30),e.St(ne(t.bytesValue)),this.bt(e);else if("referenceValue"in t)this.Dt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.ft(e,45),e.gt(n.latitude||0),e.gt(n.longitude||0)}else"mapValue"in t?kd(t)?this.ft(e,Number.MAX_SAFE_INTEGER):to(t)?this.vt(t.mapValue,e):(this.Ct(t.mapValue,e),this.bt(e)):"arrayValue"in t?(this.Ft(t.arrayValue,e),this.bt(e)):M()}wt(t,e){this.ft(e,25),this.Mt(t,e)}Mt(t,e){e.yt(t)}Ct(t,e){let n=t.fields||{};this.ft(e,55);for(let s of Object.keys(n))this.wt(s,e),this.Rt(n[s],e)}vt(t,e){var n,s;let i=t.fields||{};this.ft(e,53);let a=Dn,u=((s=(n=i[a].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.ft(e,15),e.gt(st(u)),this.wt(a,e),this.Rt(i[a],e)}Ft(t,e){let n=t.values||[];this.ft(e,50);for(let s of n)this.Rt(s,e)}Dt(t,e){this.ft(e,37),O.fromName(t).path.forEach(n=>{this.ft(e,60),this.Mt(n,e)})}ft(t,e){t.gt(e)}bt(t){t.gt(2)}};te.xt=new te;var ln=255;function ap(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Fh(r){let t=64-function(n){let s=0;for(let i=0;i<8;++i){let a=ap(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(t/8)}var qa=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ot(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Nt(n.value),n=e.next();this.Bt()}Lt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.kt(n.value),n=e.next();this.qt()}Qt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Nt(n);else if(n<2048)this.Nt(960|n>>>6),this.Nt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Nt(480|n>>>12),this.Nt(128|63&n>>>6),this.Nt(128|63&n);else{let s=e.codePointAt(0);this.Nt(240|s>>>18),this.Nt(128|63&s>>>12),this.Nt(128|63&s>>>6),this.Nt(128|63&s)}}this.Bt()}$t(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.kt(n);else if(n<2048)this.kt(960|n>>>6),this.kt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.kt(480|n>>>12),this.kt(128|63&n>>>6),this.kt(128|63&n);else{let s=e.codePointAt(0);this.kt(240|s>>>18),this.kt(128|63&s>>>12),this.kt(128|63&s>>>6),this.kt(128|63&s)}}this.qt()}Kt(t){let e=this.Ut(t),n=Fh(e);this.Wt(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}Gt(t){let e=this.Ut(t),n=Fh(e);this.Wt(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}zt(){this.jt(ln),this.jt(255)}Ht(){this.Jt(ln),this.Jt(255)}reset(){this.position=0}seed(t){this.Wt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Yt(){return this.buffer.slice(0,this.position)}Ut(t){let e=function(i){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Nt(t){let e=255&t;e===0?(this.jt(0),this.jt(255)):e===ln?(this.jt(ln),this.jt(0)):this.jt(e)}kt(t){let e=255&t;e===0?(this.Jt(0),this.Jt(255)):e===ln?(this.Jt(ln),this.Jt(0)):this.Jt(t)}Bt(){this.jt(0),this.jt(1)}qt(){this.Jt(0),this.Jt(1)}jt(t){this.Wt(1),this.buffer[this.position++]=t}Jt(t){this.Wt(1),this.buffer[this.position++]=~t}Wt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},Ua=class{constructor(t){this.Zt=t}St(t){this.Zt.Ot(t)}yt(t){this.Zt.Qt(t)}gt(t){this.Zt.Kt(t)}Vt(){this.Zt.zt()}},Ba=class{constructor(t){this.Zt=t}St(t){this.Zt.Lt(t)}yt(t){this.Zt.$t(t)}gt(t){this.Zt.Gt(t)}Vt(){this.Zt.Ht()}},Le=class{constructor(){this.Zt=new qa,this.Xt=new Ua(this.Zt),this.en=new Ba(this.Zt)}seed(t){this.Zt.seed(t)}tn(t){return t===0?this.Xt:this.en}Yt(){return this.Zt.Yt()}reset(){this.Zt.reset()}};var qe=class r{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}nn(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function ce(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=Oh(r.arrayValue,t.arrayValue),e!==0?e:(e=Oh(r.directionalValue,t.directionalValue),e!==0?e:O.comparator(r.documentKey,t.documentKey)))}function Oh(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var _i=class{constructor(t){this.rn=new tt((e,n)=>ht.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.sn=t.orderBy,this._n=[];for(let e of t.filters){let n=e;n.isInequality()?this.rn=this.rn.add(n):this._n.push(n)}}get an(){return this.rn.size>1}un(t){if(q(t.collectionGroup===this.collectionId),this.an)return!1;let e=sa(t);if(e!==void 0&&!this.cn(e))return!1;let n=ke(t),s=new Set,i=0,a=0;for(;i<n.length&&this.cn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.rn.size>0){let u=this.rn.getIterator().getNext();if(!s.has(u.field.canonicalString())){let l=n[i];if(!this.ln(u,l)||!this.hn(this.sn[a++],l))return!1}++i}for(;i<n.length;++i){let u=n[i];if(a>=this.sn.length||!this.hn(this.sn[a++],u))return!1}return!0}Pn(){if(this.an)return null;let t=new tt(ht.comparator),e=[];for(let n of this._n)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new vn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new vn(n.field,0))}for(let n of this.sn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new vn(n.field,n.dir==="asc"?0:1)));return new Sn(Sn.UNKNOWN_ID,this.collectionId,e,Dr.empty())}cn(t){for(let e of this._n)if(this.ln(e,t))return!0;return!1}ln(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}hn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function _f(r){var t,e;if(q(r instanceof Q||r instanceof J),r instanceof Q){if(r instanceof ii){let s=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(i=>Q.create(r.field,"==",i)))||[];return J.create(s,"or")}return r}let n=r.filters.map(s=>_f(s));return J.create(n,r.op)}function up(r){if(r.getFilters().length===0)return[];let t=$a(_f(r));return q(wf(t)),ja(t)||za(t)?[t]:t.getFilters()}function ja(r){return r instanceof Q}function za(r){return r instanceof J&&ic(r)}function wf(r){return ja(r)||za(r)||function(e){if(e instanceof J&&ga(e)){for(let n of e.getFilters())if(!ja(n)&&!za(n))return!1;return!0}return!1}(r)}function $a(r){if(q(r instanceof Q||r instanceof J),r instanceof Q)return r;if(r.filters.length===1)return $a(r.filters[0]);let t=r.filters.map(n=>$a(n)),e=J.create(t,r.op);return e=wi(e),wf(e)?e:(q(e instanceof J),q(kn(e)),q(e.filters.length>1),e.filters.reduce((n,s)=>cc(n,s)))}function cc(r,t){let e;return q(r instanceof Q||r instanceof J),q(t instanceof Q||t instanceof J),e=r instanceof Q?t instanceof Q?function(s,i){return J.create([s,i],"and")}(r,t):Mh(r,t):t instanceof Q?Mh(t,r):function(s,i){if(q(s.filters.length>0&&i.filters.length>0),kn(s)&&kn(i))return qd(s,i.getFilters());let a=ga(s)?s:i,u=ga(s)?i:s,l=a.filters.map(d=>cc(d,u));return J.create(l,"or")}(r,t),wi(e)}function Mh(r,t){if(kn(t))return qd(t,r.getFilters());{let e=t.filters.map(n=>cc(r,n));return J.create(e,"or")}}function wi(r){if(q(r instanceof Q||r instanceof J),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return wi(t[0]);if(Md(r))return r;let e=t.map(s=>wi(s)),n=[];return e.forEach(s=>{s instanceof Q?n.push(s):s instanceof J&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:J.create(n,r.op)}var Ga=class{constructor(){this.Tn=new Kr}addToCollectionParentIndex(t,e){return this.Tn.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.Tn.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Ft.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Ft.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},Kr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new tt(Z.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){let e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new tt(Z.comparator)).toArray()}};var Lh="IndexedDbIndexManager",ks=new Uint8Array(0),Ka=class{constructor(t,e){this.databaseId=e,this.In=new Kr,this.En=new Ut(n=>He(n),(n,s)=>cs(n,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.In.has(e)){let n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.In.add(e)});let i={collectionId:n,parent:Tt(s)};return qh(t).put(i)}return S.resolve()}getCollectionParents(t,e){let n=[],s=IDBKeyRange.bound([e,""],[fd(e),""],!1,!0);return qh(t).G(s).next(i=>{for(let a of i){if(a.collectionId!==e)break;n.push(zt(a.parent))}return n})}addFieldIndex(t,e){let n=wr(t),s=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete s.indexId;let i=n.add(s);if(e.indexState){let a=dn(t);return i.next(u=>{a.put(Dh(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return i.next()}deleteFieldIndex(t,e){let n=wr(t),s=dn(t),i=hn(t);return n.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=wr(t),n=hn(t),s=dn(t);return e.J().next(()=>n.J()).next(()=>s.J())}createTargetIndexes(t,e){return S.forEach(this.dn(e),n=>this.getIndexType(t,n).next(s=>{if(s===0||s===1){let i=new _i(n).Pn();if(i!=null)return this.addFieldIndex(t,i)}}))}getDocumentsMatchingTarget(t,e){let n=hn(t),s=!0,i=new Map;return S.forEach(this.dn(e),a=>this.An(t,a).next(u=>{s&&(s=!!u),i.set(a,u)})).next(()=>{if(s){let a=K(),u=[];return S.forEach(i,(l,d)=>{V(Lh,`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(l)} to execute ${He(e)}`);let m=function(U,W){let X=sa(W);if(X===void 0)return null;for(let G of ai(U,X.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(d,l),g=function(U,W){let X=new Map;for(let G of ke(W))for(let w of ai(U,G.fieldPath))switch(w.op){case"==":case"in":X.set(G.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return X.set(G.fieldPath.canonicalString(),w.value),Array.from(X.values())}return null}(d,l),T=function(U,W){let X=[],G=!0;for(let w of ke(W)){let p=w.kind===0?_h(U,w.fieldPath,U.startAt):wh(U,w.fieldPath,U.startAt);X.push(p.value),G&&(G=p.inclusive)}return new ye(X,G)}(d,l),b=function(U,W){let X=[],G=!0;for(let w of ke(W)){let p=w.kind===0?wh(U,w.fieldPath,U.endAt):_h(U,w.fieldPath,U.endAt);X.push(p.value),G&&(G=p.inclusive)}return new ye(X,G)}(d,l),x=this.Rn(l,d,T),k=this.Rn(l,d,b),D=this.Vn(l,d,g),$=this.mn(l.indexId,m,x,T.inclusive,k,b.inclusive,D);return S.forEach($,j=>n.H(j,e.limit).next(U=>{U.forEach(W=>{let X=O.fromSegments(W.documentKey);a.has(X)||(a=a.add(X),u.push(X))})}))}).next(()=>u)}return S.resolve(null)})}dn(t){let e=this.En.get(t);return e||(t.filters.length===0?e=[t]:e=up(J.create(t.filters,"and")).map(n=>Aa(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.En.set(t,e),e)}mn(t,e,n,s,i,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),m=[];for(let g=0;g<l;++g){let T=e?this.fn(e[g/d]):ks,b=this.gn(t,T,n[g%d],s),x=this.pn(t,T,i[g%d],a),k=u.map(D=>this.gn(t,T,D,!0));m.push(...this.createRange(b,x,k))}return m}gn(t,e,n,s){let i=new qe(t,O.empty(),e,n);return s?i:i.nn()}pn(t,e,n,s){let i=new qe(t,O.empty(),e,n);return s?i.nn():i}An(t,e){let n=new _i(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(i=>{let a=null;for(let u of i)n.un(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,s=this.dn(e);return S.forEach(s,i=>this.An(t,i).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new tt(ht.comparator),m=!1;for(let g of l.filters)for(let T of g.getFlattenedFilters())T.field.isKeyField()||(T.op==="array-contains"||T.op==="array-contains-any"?m=!0:d=d.add(T.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(m?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&s.length>1&&n===2?1:n)}yn(t,e){let n=new Le;for(let s of ke(t)){let i=e.data.field(s.fieldPath);if(i==null)return null;let a=n.tn(s.kind);te.xt.At(i,a)}return n.Yt()}fn(t){let e=new Le;return te.xt.At(t,e.tn(0)),e.Yt()}wn(t,e){let n=new Le;return te.xt.At(Ur(this.databaseId,e),n.tn(function(i){let a=ke(i);return a.length===0?0:a[a.length-1].kind}(t))),n.Yt()}Vn(t,e,n){if(n===null)return[];let s=[];s.push(new Le);let i=0;for(let a of ke(t)){let u=n[i++];for(let l of s)if(this.bn(e,a.fieldPath)&&Br(u))s=this.Sn(s,a,u);else{let d=l.tn(a.kind);te.xt.At(u,d)}}return this.Dn(s)}Rn(t,e,n){return this.Vn(t,e,n.position)}Dn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Yt();return e}Sn(t,e,n){let s=[...t],i=[];for(let a of n.arrayValue.values||[])for(let u of s){let l=new Le;l.seed(u.Yt()),te.xt.At(a,l.tn(e.kind)),i.push(l)}return i}bn(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=wr(t),s=dn(t);return(e?n.G(la,IDBKeyRange.bound(e,e)):n.G()).next(i=>{let a=[];return S.forEach(i,u=>s.get([u.indexId,this.uid]).next(l=>{a.push(function(m,g){let T=g?new Dr(g.sequenceNumber,new Ft(Je(g.readTime),new O(zt(g.documentKey)),g.largestBatchId)):Dr.empty(),b=m.fields.map(([x,k])=>new vn(ht.fromServerFormat(x),k));return new Sn(m.indexId,m.collectionGroup,b,T)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,s)=>{let i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:z(n.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let s=wr(t),i=dn(t);return this.vn(t).next(a=>s.G(la,IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,l=>i.put(Dh(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(s,i)=>{let a=n.get(s.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next(u=>(n.set(s.collectionGroup,u),S.forEach(u,l=>this.Cn(t,s,l).next(d=>{let m=this.Fn(i,l);return d.isEqual(m)?S.resolve():this.Mn(t,i,l,d,m)}))))})}xn(t,e,n,s){return hn(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.wn(n,e.key),documentKey:e.key.path.toArray()})}On(t,e,n,s){return hn(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.wn(n,e.key),e.key.path.toArray()])}Cn(t,e,n){let s=hn(t),i=new tt(ce);return s.Z({index:Ed,range:IDBKeyRange.only([n.indexId,this.uid,this.wn(n,e)])},(a,u)=>{i=i.add(new qe(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>i)}Fn(t,e){let n=new tt(ce),s=this.yn(e,t);if(s==null)return n;let i=sa(e);if(i!=null){let a=t.data.field(i.fieldPath);if(Br(a))for(let u of a.arrayValue.values||[])n=n.add(new qe(e.indexId,t.key,this.fn(u),s))}else n=n.add(new qe(e.indexId,t.key,ks,s));return n}Mn(t,e,n,s,i){V(Lh,"Updating index entries for document '%s'",e.key);let a=[];return function(l,d,m,g,T){let b=l.getIterator(),x=d.getIterator(),k=cn(b),D=cn(x);for(;k||D;){let $=!1,j=!1;if(k&&D){let U=m(k,D);U<0?j=!0:U>0&&($=!0)}else k!=null?j=!0:$=!0;$?(g(D),D=cn(x)):j?(T(k),k=cn(b)):(k=cn(b),D=cn(x))}}(s,i,ce,u=>{a.push(this.xn(t,e,n,u))},u=>{a.push(this.On(t,e,n,u))}),S.waitFor(a)}vn(t){let e=1;return dn(t).Z({index:Id,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>ce(a,u)).filter((a,u,l)=>!u||ce(a,l[u-1])!==0);let s=[];s.push(t);for(let a of n){let u=ce(a,t),l=ce(a,e);if(u===0)s[0]=t.nn();else if(u>0&&l<0)s.push(a),s.push(a.nn());else if(l>0)break}s.push(e);let i=[];for(let a=0;a<s.length;a+=2){if(this.Nn(s[a],s[a+1]))return[];let u=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,ks,[]],l=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,ks,[]];i.push(IDBKeyRange.bound(u,l))}return i}Nn(t,e){return ce(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Uh)}getMinOffset(t,e){return S.mapArray(this.dn(e),n=>this.An(t,n).next(s=>s||M())).next(Uh)}};function qh(r){return dt(r,Or)}function hn(r){return dt(r,ti)}function wr(r){return dt(r,Zu)}function dn(r){return dt(r,Zs)}function Uh(r){q(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let s=r[n].indexState.offset;Yu(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Ft(t.readTime,t.documentKey,e)}var Bh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},vf=41943040,Rt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function Tf(r,t,e){let n=r.store(Lt),s=r.store(bn),i=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.Z({range:a},(m,g,T)=>(u++,T.delete()));i.push(l.next(()=>{q(u===1)}));let d=[];for(let m of e.mutations){let g=wd(t,m.key.path,e.batchId);i.push(s.delete(g)),d.push(m.key)}return S.waitFor(i).next(()=>d)}function vi(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw M();t=r.noDocument}return JSON.stringify(t).length}Rt.DEFAULT_COLLECTION_PERCENTILE=10,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rt.DEFAULT=new Rt(vf,Rt.DEFAULT_COLLECTION_PERCENTILE,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rt.DISABLED=new Rt(-1,0,0);var Ti=class r{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Bn={}}static It(t,e,n,s){q(t.uid!=="");let i=t.isAuthenticated()?t.uid:"";return new r(i,e,n,s)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return le(t).Z({index:Ue,range:n},(s,i,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,s){let i=_n(t),a=le(t);return a.add({}).next(u=>{q(typeof u=="number");let l=new jr(u,e,n,s),d=function(b,x,k){let D=k.baseMutations.map(j=>mi(b.Tt,j)),$=k.mutations.map(j=>mi(b.Tt,j));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:$}}(this.serializer,this.userId,l),m=[],g=new tt((T,b)=>z(T.canonicalString(),b.canonicalString()));for(let T of s){let b=wd(this.userId,T.key.path,u);g=g.add(T.key.path.popLast()),m.push(a.put(d)),m.push(i.put(b,ig))}return g.forEach(T=>{m.push(this.indexManager.addToCollectionParentIndex(t,T))}),t.addOnCommittedListener(()=>{this.Bn[u]=l.keys()}),S.waitFor(m).next(()=>l)})}lookupMutationBatch(t,e){return le(t).get(e).next(n=>n?(q(n.userId===this.userId),Me(this.serializer,n)):null)}Ln(t,e){return this.Bn[e]?S.resolve(this.Bn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let s=n.keys();return this.Bn[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]),i=null;return le(t).Z({index:Ue,range:s},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n),i=Me(this.serializer,u)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=$e;return le(t).Z({index:Ue,range:e,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,$e],[this.userId,Number.POSITIVE_INFINITY]);return le(t).G(Ue,e).next(n=>n.map(s=>Me(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Ls(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return _n(t).Z({range:s},(a,u,l)=>{let[d,m,g]=a,T=zt(m);if(d===this.userId&&e.path.isEqual(T))return le(t).get(g).next(b=>{if(!b)throw M();q(b.userId===this.userId),i.push(Me(this.serializer,b))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(z),s=[];return e.forEach(i=>{let a=Ls(this.userId,i.path),u=IDBKeyRange.lowerBound(a),l=_n(t).Z({range:u},(d,m,g)=>{let[T,b,x]=d,k=zt(b);T===this.userId&&i.path.isEqual(k)?n=n.add(x):g.done()});s.push(l)}),S.waitFor(s).next(()=>this.kn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=Ls(this.userId,n),a=IDBKeyRange.lowerBound(i),u=new tt(z);return _n(t).Z({range:a},(l,d,m)=>{let[g,T,b]=l,x=zt(T);g===this.userId&&n.isPrefixOf(x)?x.length===s&&(u=u.add(b)):m.done()}).next(()=>this.kn(t,u))}kn(t,e){let n=[],s=[];return e.forEach(i=>{s.push(le(t).get(i).next(a=>{if(a===null)throw M();q(a.userId===this.userId),n.push(Me(this.serializer,a))}))}),S.waitFor(s).next(()=>n)}removeMutationBatch(t,e){return Tf(t.ue,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.qn(e.batchId)}),S.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}qn(t){delete this.Bn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return _n(t).Z({range:n},(i,a,u)=>{if(i[0]===this.userId){let l=zt(i[1]);s.push(l)}else u.done()}).next(()=>{q(s.length===0)})})}containsKey(t,e){return If(t,this.userId,e)}Qn(t){return Ef(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:$e,lastStreamToken:""})}};function If(r,t,e){let n=Ls(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return _n(r).Z({range:i,Y:!0},(u,l,d)=>{let[m,g,T]=u;m===t&&g===s&&(a=!0),d.done()}).next(()=>a)}function le(r){return dt(r,Lt)}function _n(r){return dt(r,bn)}function Ef(r){return dt(r,kr)}var Un=class r{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new r(0)}static Un(){return new r(-1)}};var Qa=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Wn(t).next(e=>{let n=new Un(e.highestTargetId);return e.highestTargetId=n.next(),this.Gn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Wn(t).next(e=>B.fromTimestamp(new at(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Wn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.Wn(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Gn(t,s)))}addTargetData(t,e){return this.zn(t,e).next(()=>this.Wn(t).next(n=>(n.targetCount+=1,this.jn(e,n),this.Gn(t,n))))}updateTargetData(t,e){return this.zn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>fn(t).delete(e.targetId)).next(()=>this.Wn(t)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Gn(t,n)))}removeTargets(t,e,n){let s=0,i=[];return fn(t).Z((a,u)=>{let l=Er(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))}).next(()=>S.waitFor(i)).next(()=>s)}forEachTarget(t,e){return fn(t).Z((n,s)=>{let i=Er(s);e(i)})}Wn(t){return jh(t).get(Js).next(e=>(q(e!==null),e))}Gn(t,e){return jh(t).put(Js,e)}zn(t,e){return fn(t).put(pf(this.serializer,e))}jn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Wn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=He(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return fn(t).Z({range:s,index:Td},(a,u,l)=>{let d=Er(u);cs(e,d.target)&&(i=d,l.done())}).next(()=>i)}addMatchingKeys(t,e,n){let s=[],i=de(t);return e.forEach(a=>{let u=Tt(a.path);s.push(i.put({targetId:n,path:u})),s.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(s)}removeMatchingKeys(t,e,n){let s=de(t);return S.forEach(e,i=>{let a=Tt(i.path);return S.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])})}removeMatchingKeysForTargetId(t,e){let n=de(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),s=de(t),i=K();return s.Z({range:n,Y:!0},(a,u,l)=>{let d=zt(a[1]),m=new O(d);i=i.add(m)}).next(()=>i)}containsKey(t,e){let n=Tt(e.path),s=IDBKeyRange.bound([n],[fd(n)],!1,!0),i=0;return de(t).Z({index:Ju,Y:!0,range:s},([a,u],l,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}lt(t,e){return fn(t).get(e).next(n=>n?Er(n):null)}};function fn(r){return dt(r,Pn)}function jh(r){return dt(r,Ge)}function de(r){return dt(r,Vn)}var zh="LruGarbageCollector",Af=1048576;function $h([r,t],[e,n]){let s=z(r,e);return s===0?z(t,n):s}var Wa=class{constructor(t){this.Hn=t,this.buffer=new tt($h),this.Jn=0}Yn(){return++this.Jn}Zn(t){let e=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();$h(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},Ii=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){V(zh,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>C(this,null,function*(){this.Xn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){be(e)?V(zh,"Ignoring IndexedDB error during garbage collection: ",e):yield Re(e)}yield this.er(3e5)}))}},Ha=class{constructor(t,e){this.tr=t,this.params=e}calculateTargetCount(t,e){return this.tr.nr(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Ct.ae);let n=new Wa(e);return this.tr.forEachTarget(t,s=>n.Zn(s.sequenceNumber)).next(()=>this.tr.rr(t,s=>n.Zn(s))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.tr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.tr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Bh)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bh):this.ir(t,e))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,e){let n,s,i,a,u,l,d,m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(t,s))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(i=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),mn()<=Bt.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${i} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-m}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g})))}};function Sf(r,t){return new Ha(r,t)}var Ya=class{constructor(t,e){this.db=t,this.garbageCollector=Sf(this,e)}nr(t){let e=this.sr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}sr(t){let e=0;return this.rr(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}rr(t,e){return this._r(t,(n,s)=>e(s))}addReference(t,e,n){return Fs(t,n)}removeReference(t,e,n){return Fs(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Fs(t,e)}ar(t,e){return function(s,i){let a=!1;return Ef(s).X(u=>If(s,u,i).next(l=>(l&&(a=!0),S.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],i=0;return this._r(t,(a,u)=>{if(u<=e){let l=this.ar(t,a).next(d=>{if(!d)return i++,n.getEntry(t,a).next(()=>(n.removeEntry(a,B.min()),de(t).delete(function(g){return[0,Tt(g.path)]}(a))))});s.push(l)}}).next(()=>S.waitFor(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Fs(t,e)}_r(t,e){let n=de(t),s,i=Ct.ae;return n.Z({index:Ju},([a,u],{path:l,sequenceNumber:d})=>{a===0?(i!==Ct.ae&&e(new O(zt(s)),i),i=d,s=l):i=Ct.ae}).next(()=>{i!==Ct.ae&&e(new O(zt(s)),i)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Fs(r,t){return de(r).put(function(n,s){return{targetId:0,path:Tt(n.path),sequenceNumber:s}}(t,r.currentSequenceNumber))}var Ei=class{constructor(){this.changes=new Ut(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,gt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Xa=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Ne(t).put(n)}removeEntry(t,e,n){return Ne(t).delete(function(i,a){let u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],pi(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.ur(t,n)))}getEntry(t,e){let n=gt.newInvalidDocument(e);return Ne(t).Z({index:qs,range:IDBKeyRange.only(vr(e))},(s,i)=>{n=this.cr(e,i)}).next(()=>n)}lr(t,e){let n={size:0,document:gt.newInvalidDocument(e)};return Ne(t).Z({index:qs,range:IDBKeyRange.only(vr(e))},(s,i)=>{n={document:this.cr(e,i),size:vi(i)}}).next(()=>n)}getEntries(t,e){let n=xt();return this.hr(t,e,(s,i)=>{let a=this.cr(s,i);n=n.insert(s,a)}).next(()=>n)}Pr(t,e){let n=xt(),s=new rt(O.comparator);return this.hr(t,e,(i,a)=>{let u=this.cr(i,a);n=n.insert(i,u),s=s.insert(i,vi(a))}).next(()=>({documents:n,Tr:s}))}hr(t,e,n){if(e.isEmpty())return S.resolve();let s=new tt(Qh);e.forEach(l=>s=s.add(l));let i=IDBKeyRange.bound(vr(s.first()),vr(s.last())),a=s.getIterator(),u=a.getNext();return Ne(t).Z({index:qs,range:i},(l,d,m)=>{let g=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Qh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?m.W(vr(u)):m.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,s,i){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),pi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ne(t).G(IDBKeyRange.bound(u,l,!0)).next(d=>{i?.incrementDocumentReadCount(d.length);let m=xt();for(let g of d){let T=this.cr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);T.isFoundDocument()&&(hs(e,T)||s.has(T.key))&&(m=m.insert(T.key,T))}return m})}getAllFromCollectionGroup(t,e,n,s){let i=xt(),a=Kh(e,n),u=Kh(e,Ft.max());return Ne(t).Z({index:vd,range:IDBKeyRange.bound(a,u,!0)},(l,d,m)=>{let g=this.cr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(g.key,g),i.size===s&&m.done()}).next(()=>i)}newChangeBuffer(t){return new Ja(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Gh(t).get(ca).next(e=>(q(!!e),e))}ur(t,e){return Gh(t).put(ca,e)}cr(t,e){if(e){let n=op(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return gt.newInvalidDocument(t)}};function Rf(r){return new Xa(r)}var Ja=class extends Ei{constructor(t,e){super(),this.Ir=t,this.trackRemovals=e,this.Er=new Ut(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(t){let e=[],n=0,s=new tt((i,a)=>z(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{let u=this.Er.get(i);if(e.push(this.Ir.removeEntry(t,i,u.readTime)),a.isValidDocument()){let l=Ch(this.Ir.serializer,a);s=s.add(i.path.popLast());let d=vi(l);n+=d-u.size,e.push(this.Ir.addEntry(t,i,l))}else if(n-=u.size,this.trackRemovals){let l=Ch(this.Ir.serializer,a.convertToNoDocument(B.min()));e.push(this.Ir.addEntry(t,i,l))}}),s.forEach(i=>{e.push(this.Ir.indexManager.addToCollectionParentIndex(t,i))}),e.push(this.Ir.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.Ir.lr(t,e).next(n=>(this.Er.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.Ir.Pr(t,e).next(({documents:n,Tr:s})=>(s.forEach((i,a)=>{this.Er.set(i,{size:a,readTime:n.get(i).readTime})}),n))}};function Gh(r){return dt(r,Fr)}function Ne(r){return dt(r,Xs)}function vr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Kh(r,t){let e=t.documentKey.path.toArray();return[r,pi(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Qh(r,t){let e=r.path.toArray(),n=t.path.toArray(),s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=z(e[i],n[i]),s)return s;return s=z(e.length,n.length),s||(s=z(e[e.length-2],n[n.length-2]),s||z(e[e.length-1],n[n.length-1]))}var Za=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Ai=class{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(n=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(n!==null&&Pr(n.mutation,s,qt.empty(),at.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let s=$t();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,n).next(i=>{let a=Ir();return i.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=$t();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let s=[];return n.forEach(i=>{e.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,s){let i=xt(),a=br(),u=function(){return br()}();return e.forEach((l,d)=>{let m=n.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof Wt)?i=i.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),Pr(m.mutation,d,m.mutation.getFieldMask(),at.now())):a.set(d.key,qt.empty())}),this.recalculateAndSaveOverlays(t,i).next(l=>(l.forEach((d,m)=>a.set(d,m)),e.forEach((d,m)=>{var g;return u.set(d,new Za(m,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=br(),s=new rt((a,u)=>a-u),i=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let m=n.get(l)||qt.empty();m=u.applyToLocalView(d,m),n.set(l,m);let g=(s.get(u.batchId)||K()).add(l);s=s.insert(u.batchId,g)})}).next(()=>{let a=[],u=s.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,m=l.value,g=Hd();m.forEach(T=>{if(!i.has(T)){let b=ef(e.get(T),n.get(T));b!==null&&g.set(T,b),i=i.add(T)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,s){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):zd(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next(i=>{let a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):S.resolve($t()),u=An,l=i;return a.next(d=>S.forEach(d,(m,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),i.get(m)?S.resolve():this.remoteDocumentCache.getEntry(t,m).next(T=>{l=l.insert(m,T)}))).next(()=>this.populateOverlays(t,d,i)).next(()=>this.computeViews(t,l,d,K())).next(m=>({batchId:u,changes:Wd(m)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let s=Ir();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){let i=e.collectionGroup,a=Ir();return this.indexManager.getCollectionParents(t,i).next(u=>S.forEach(u,l=>{let d=function(g,T){return new _e(T,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next(m=>{m.forEach((g,T)=>{a=a.insert(g,T)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s))).next(a=>{i.forEach((l,d)=>{let m=d.getKey();a.get(m)===null&&(a=a.insert(m,gt.newInvalidDocument(m)))});let u=Ir();return a.forEach((l,d)=>{let m=i.get(l);m!==void 0&&Pr(m.mutation,d,qt.empty(),at.now()),hs(e,d)&&(u=u.insert(l,d))}),u})}};var tu=class{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,e){return S.resolve(this.dr.get(e))}saveBundleMetadata(t,e){return this.dr.set(e.id,function(s){return{id:s.id,version:s.version,createTime:At(s.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Ar.get(e))}saveNamedQuery(t,e){return this.Ar.set(e.name,function(s){return{name:s.name,query:yf(s.bundledQuery),readTime:At(s.readTime)}}(e)),S.resolve()}};var eu=class{constructor(){this.overlays=new rt(O.comparator),this.Rr=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=$t();return S.forEach(e,s=>this.getOverlay(t,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((s,i)=>{this.Et(t,e,i)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let s=this.Rr.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Rr.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let s=$t(),i=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return S.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new rt((d,m)=>d-m),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let m=i.get(d.largestBatchId);m===null&&(m=$t(),i=i.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}let u=$t(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,m)=>u.set(d,m)),!(u.size()>=s)););return S.resolve(u)}Et(t,e,n){let s=this.overlays.get(n.key);if(s!==null){let a=this.Rr.get(s.largestBatchId).delete(n.key);this.Rr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new zr(e,n));let i=this.Rr.get(e);i===void 0&&(i=K(),this.Rr.set(e,i)),this.Rr.set(e,i.add(n.key))}};var nu=class{constructor(){this.sessionToken=lt.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Qr=class{constructor(){this.Vr=new tt(ct.mr),this.gr=new tt(ct.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,e){let n=new ct(t,e);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.wr(new ct(t,e))}br(t,e){t.forEach(n=>this.removeReference(n,e))}Sr(t){let e=new O(new Z([])),n=new ct(e,t),s=new ct(e,t+1),i=[];return this.gr.forEachInRange([n,s],a=>{this.wr(a),i.push(a.key)}),i}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){let e=new O(new Z([])),n=new ct(e,t),s=new ct(e,t+1),i=K();return this.gr.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(t){let e=new ct(t,0),n=this.Vr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},ct=class{constructor(t,e){this.key=t,this.Cr=e}static mr(t,e){return O.comparator(t.key,e.key)||z(t.Cr,e.Cr)}static pr(t,e){return z(t.Cr,e.Cr)||O.comparator(t.key,e.key)}};var ru=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Fr=1,this.Mr=new tt(ct.mr)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){let i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new jr(i,e,n,s);this.mutationQueue.push(a);for(let u of s)this.Mr=this.Mr.add(new ct(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Or(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,s=this.Nr(n),i=s<0?0:s;return S.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?$e:this.Fr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new ct(e,0),s=new ct(e,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([n,s],a=>{let u=this.Or(a.Cr);i.push(u)}),S.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new tt(z);return e.forEach(s=>{let i=new ct(s,0),a=new ct(s,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([i,a],u=>{n=n.add(u.Cr)})}),S.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,s=n.length+1,i=n;O.isDocumentKey(i)||(i=i.child(""));let a=new ct(new O(i),0),u=new tt(z);return this.Mr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(u=u.add(l.Cr)),!0)},a),S.resolve(this.Br(u))}Br(t){let e=[];return t.forEach(n=>{let s=this.Or(n);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){q(this.Lr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.Mr;return S.forEach(e.mutations,s=>{let i=new ct(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Mr=n})}qn(t){}containsKey(t,e){let n=new ct(e,0),s=this.Mr.firstAfterOrEqual(n);return S.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Lr(t,e){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){let e=this.Nr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var su=class{constructor(t){this.kr=t,this.docs=function(){return new rt(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.kr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():gt.newInvalidDocument(e))}getEntries(t,e){let n=xt();return e.forEach(s=>{let i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():gt.newInvalidDocument(s))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=xt(),a=e.path,u=new O(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:m}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Yu(gd(m),n)<=0||(s.has(m.key)||hs(e,m))&&(i=i.insert(m.key,m.mutableCopy()))}return S.resolve(i)}getAllFromCollectionGroup(t,e,n,s){M()}qr(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new iu(this)}getSize(t){return S.resolve(this.size)}},iu=class extends Ei{constructor(t){super(),this.Ir=t}applyChanges(t){let e=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?e.push(this.Ir.addEntry(t,s)):this.Ir.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.Ir.getEntry(t,e)}getAllFromCache(t,e){return this.Ir.getEntries(t,e)}};var ou=class{constructor(t){this.persistence=t,this.Qr=new Ut(e=>He(e),cs),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.$r=0,this.Kr=new Qr,this.targetCount=0,this.Ur=Un.Kn()}forEachTarget(t,e){return this.Qr.forEach((n,s)=>e(s)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.$r&&(this.$r=e),S.resolve()}zn(t){this.Qr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Ur=new Un(e),this.highestTargetId=e),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,e){return this.zn(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.zn(e),S.resolve()}removeTargetData(t,e){return this.Qr.delete(e.target),this.Kr.Sr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let s=0,i=[];return this.Qr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Qr.delete(a),i.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)}),S.waitFor(i).next(()=>s)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Qr.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.Kr.yr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.Kr.br(e,n);let s=this.persistence.referenceDelegate,i=[];return s&&e.forEach(a=>{i.push(s.markPotentiallyOrphaned(t,a))}),S.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Kr.Sr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Kr.vr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.Kr.containsKey(e))}};var Wr=class{constructor(t,e){this.Wr={},this.overlays={},this.Gr=new Ct(0),this.zr=!1,this.zr=!0,this.jr=new nu,this.referenceDelegate=t(this),this.Hr=new ou(this),this.indexManager=new Ga,this.remoteDocumentCache=function(s){return new su(s)}(n=>this.referenceDelegate.Jr(n)),this.serializer=new gi(e),this.Yr=new tu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new eu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Wr[t.toKey()];return n||(n=new ru(e,this.referenceDelegate),this.Wr[t.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,e,n){V("MemoryPersistence","Starting transaction:",t);let s=new au(this.Gr.next());return this.referenceDelegate.Zr(),n(s).next(i=>this.referenceDelegate.Xr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}ei(t,e){return S.or(Object.values(this.Wr).map(n=>()=>n.containsKey(t,e)))}},au=class extends Ws{constructor(t){super(),this.currentSequenceNumber=t}},Si=class r{constructor(t){this.persistence=t,this.ti=new Qr,this.ni=null}static ri(t){return new r(t)}get ii(){if(this.ni)return this.ni;throw M()}addReference(t,e,n){return this.ti.addReference(n,e),this.ii.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.ti.removeReference(n,e),this.ii.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.ii.add(e.toString()),S.resolve()}removeTarget(t,e){this.ti.Sr(e.targetId).forEach(s=>this.ii.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(i=>this.ii.add(i.toString()))}).next(()=>n.removeTargetData(t,e))}Zr(){this.ni=new Set}Xr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.ii,n=>{let s=O.fromPath(n);return this.si(t,s).next(i=>{i||e.removeEntry(s,B.min())})}).next(()=>(this.ni=null,e.apply(t)))}updateLimboDocument(t,e){return this.si(t,e).next(n=>{n?this.ii.delete(e.toString()):this.ii.add(e.toString())})}Jr(t){return 0}si(t,e){return S.or([()=>S.resolve(this.ti.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.ei(t,e)])}},Ri=class r{constructor(t,e){this.persistence=t,this.oi=new Ut(n=>Tt(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Sf(this,e)}static ri(t,e){return new r(t,e)}Zr(){}Xr(t){return S.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}nr(t){let e=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(s=>n+s))}sr(t){let e=0;return this.rr(t,n=>{e++}).next(()=>e)}rr(t,e){return S.forEach(this.oi,(n,s)=>this.ar(t,n,s).next(i=>i?S.resolve():e(s)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.qr(t,a=>this.ar(t,a,e).next(u=>{u||(n++,i.removeEntry(a,B.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.oi.set(e,t.currentSequenceNumber),S.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.oi.set(n,t.currentSequenceNumber),S.resolve()}removeReference(t,e,n){return this.oi.set(n,t.currentSequenceNumber),S.resolve()}updateLimboDocument(t,e){return this.oi.set(e,t.currentSequenceNumber),S.resolve()}Jr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Bs(t.data.value)),e}ar(t,e,n){return S.or([()=>this.persistence.ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.oi.get(e);return S.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var uu=class{constructor(t){this.serializer=t}B(t,e,n,s){let i=new Hs("createOrUpgrade",e);n<1&&s>=1&&(function(l){l.createObjectStore(us)}(t),function(l){l.createObjectStore(kr,{keyPath:sg}),l.createObjectStore(Lt,{keyPath:ah,autoIncrement:!0}).createIndex(Ue,uh,{unique:!0}),l.createObjectStore(bn)}(t),Wh(t),function(l){l.createObjectStore(Fe)}(t));let a=S.resolve();return n<3&&s>=3&&(n!==0&&(function(l){l.deleteObjectStore(Vn),l.deleteObjectStore(Pn),l.deleteObjectStore(Ge)}(t),Wh(t)),a=a.next(()=>function(l){let d=l.store(Ge),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put(Js,m)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store(Lt).G().next(g=>{l.deleteObjectStore(Lt),l.createObjectStore(Lt,{keyPath:ah,autoIncrement:!0}).createIndex(Ue,uh,{unique:!0});let T=d.store(Lt),b=g.map(x=>T.put(x));return S.waitFor(b)})}(t,i))),a=a.next(()=>{(function(l){l.createObjectStore(Cn,{keyPath:fg})})(t)})),n<5&&s>=5&&(a=a.next(()=>this._i(i))),n<6&&s>=6&&(a=a.next(()=>(function(l){l.createObjectStore(Fr)}(t),this.ai(i)))),n<7&&s>=7&&(a=a.next(()=>this.ui(i))),n<8&&s>=8&&(a=a.next(()=>this.ci(t,i))),n<9&&s>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&s>=10&&(a=a.next(()=>this.li(i))),n<11&&s>=11&&(a=a.next(()=>{(function(l){l.createObjectStore(Yi,{keyPath:mg})})(t),function(l){l.createObjectStore(Xi,{keyPath:gg})}(t)})),n<12&&s>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore(Ji,{keyPath:Ig});d.createIndex(ha,Eg,{unique:!1}),d.createIndex(Ad,Ag,{unique:!1})})(t)})),n<13&&s>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore(Xs,{keyPath:og});d.createIndex(qs,ag),d.createIndex(vd,ug)}(t)).next(()=>this.hi(t,i)).next(()=>t.deleteObjectStore(Fe))),n<14&&s>=14&&(a=a.next(()=>this.Pi(t,i))),n<15&&s>=15&&(a=a.next(()=>function(l){l.createObjectStore(Zu,{keyPath:pg,autoIncrement:!0}).createIndex(la,yg,{unique:!1}),l.createObjectStore(Zs,{keyPath:_g}).createIndex(Id,wg,{unique:!1}),l.createObjectStore(ti,{keyPath:vg}).createIndex(Ed,Tg,{unique:!1})}(t))),n<16&&s>=16&&(a=a.next(()=>{e.objectStore(Zs).clear()}).next(()=>{e.objectStore(ti).clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(l){l.createObjectStore(tc,{keyPath:Sg})})(t)})),a}ai(t){let e=0;return t.store(Fe).Z((n,s)=>{e+=vi(s)}).next(()=>{let n={byteSize:e};return t.store(Fr).put(ca,n)})}_i(t){let e=t.store(kr),n=t.store(Lt);return e.G().next(s=>S.forEach(s,i=>{let a=IDBKeyRange.bound([i.userId,$e],[i.userId,i.lastAcknowledgedBatchId]);return n.G(Ue,a).next(u=>S.forEach(u,l=>{q(l.userId===i.userId);let d=Me(this.serializer,l);return Tf(t,i.userId,d).next(()=>{})}))}))}ui(t){let e=t.store(Vn),n=t.store(Fe);return t.store(Ge).get(Js).next(s=>{let i=[];return n.Z((a,u)=>{let l=new Z(a),d=function(g){return[0,Tt(g)]}(l);i.push(e.get(d).next(m=>m?S.resolve():(g=>e.put({targetId:0,path:Tt(g),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>S.waitFor(i))})}ci(t,e){t.createObjectStore(Or,{keyPath:dg});let n=e.store(Or),s=new Kr,i=a=>{if(s.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:Tt(l)})}};return e.store(Fe).Z({Y:!0},(a,u)=>{let l=new Z(a);return i(l.popLast())}).next(()=>e.store(bn).Z({Y:!0},([a,u,l],d)=>{let m=zt(u);return i(m.popLast())}))}li(t){let e=t.store(Pn);return e.Z((n,s)=>{let i=Er(s),a=pf(this.serializer,i);return e.put(a)})}hi(t,e){let n=e.store(Fe),s=[];return n.Z((i,a)=>{let u=e.store(Xs),l=function(g){return g.document?new O(Z.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):M()}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(u.put(d))}).next(()=>S.waitFor(s))}Pi(t,e){let n=e.store(Lt),s=Rf(this.serializer),i=new Wr(Si.ri,this.serializer.Tt);return n.G().next(a=>{let u=new Map;return a.forEach(l=>{var d;let m=(d=u.get(l.userId))!==null&&d!==void 0?d:K();Me(this.serializer,l).keys().forEach(g=>m=m.add(g)),u.set(l.userId,m)}),S.forEach(u,(l,d)=>{let m=new ft(d),g=yi.It(this.serializer,m),T=i.getIndexManager(m),b=Ti.It(m,this.serializer,T,i.referenceDelegate);return new Ai(s,b,g,T).recalculateAndSaveOverlaysForDocumentKeys(new Mr(e,Ct.ae),l).next()})})}};function Wh(r){r.createObjectStore(Vn,{keyPath:lg}).createIndex(Ju,hg,{unique:!0}),r.createObjectStore(Pn,{keyPath:"targetId"}).createIndex(Td,cg,{unique:!0}),r.createObjectStore(Ge)}var he="IndexedDbPersistence",Ko=18e5,Qo=5e3,Wo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cp="main",cu=class r{constructor(t,e,n,s,i,a,u,l,d,m,g=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ti=i,this.window=a,this.document=u,this.Ii=d,this.Ei=m,this.di=g,this.Gr=null,this.zr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ai=null,this.inForeground=!1,this.Ri=null,this.Vi=null,this.mi=Number.NEGATIVE_INFINITY,this.fi=T=>Promise.resolve(),!r.D())throw new N(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ya(this,s),this.gi=e+cp,this.serializer=new gi(l),this.pi=new Rn(this.gi,this.di,new uu(this.serializer)),this.jr=new La,this.Hr=new Qa(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Rf(this.serializer),this.Yr=new Ma,this.window&&this.window.localStorage?this.yi=this.window.localStorage:(this.yi=null,m===!1&&ot(he,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(P.FAILED_PRECONDITION,Wo);return this.bi(),this.Si(),this.Di(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Hr.getHighestSequenceNumber(t))}).then(t=>{this.Gr=new Ct(t,this.Ii)}).then(()=>{this.zr=!0}).catch(t=>(this.pi&&this.pi.close(),Promise.reject(t)))}Ci(t){return this.fi=e=>C(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.pi.k(e=>C(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Ti.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.wi())})))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Os(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Fi(t).next(e=>{e||(this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Mi(t)).next(e=>this.isPrimary&&!e?this.xi(t).next(()=>!1):!!e&&this.Oi(t).next(()=>!0))).catch(t=>{if(be(t))return V(he,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return V(he,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Ti.enqueueRetryable(()=>this.fi(t)),this.isPrimary=t})}Fi(t){return Tr(t).get(un).next(e=>S.resolve(this.Ni(e)))}Bi(t){return Os(t).delete(this.clientId)}Li(){return C(this,null,function*(){if(this.isPrimary&&!this.ki(this.mi,Ko)){this.mi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=dt(e,Cn);return n.G().next(s=>{let i=this.qi(s,Ko),a=s.filter(u=>i.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.yi)for(let e of t)this.yi.removeItem(this.Qi(e.clientId))}})}Di(){this.Vi=this.Ti.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Li()).then(()=>this.Di()))}Ni(t){return!!t&&t.ownerId===this.clientId}Mi(t){return this.Ei?S.resolve(!0):Tr(t).get(un).next(e=>{if(e!==null&&this.ki(e.leaseTimestampMs,Qo)&&!this.$i(e.ownerId)){if(this.Ni(e)&&this.networkEnabled)return!0;if(!this.Ni(e)){if(!e.allowTabSynchronization)throw new N(P.FAILED_PRECONDITION,Wo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Os(t).G().next(n=>this.qi(n,Qo).find(s=>{if(this.clientId!==s.clientId){let i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,u=this.networkEnabled===s.networkEnabled;if(i||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&V(he,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return C(this,null,function*(){this.zr=!1,this.Ki(),this.Vi&&(this.Vi.cancel(),this.Vi=null),this.Ui(),this.Wi(),yield this.pi.runTransaction("shutdown","readwrite",[us,Cn],t=>{let e=new Mr(t,Ct.ae);return this.xi(e).next(()=>this.Bi(e))}),this.pi.close(),this.Gi()})}qi(t,e){return t.filter(n=>this.ki(n.updateTimeMs,e)&&!this.$i(n.clientId))}zi(){return this.runTransaction("getActiveClients","readonly",t=>Os(t).G().next(e=>this.qi(e,Ko).map(n=>n.clientId)))}get started(){return this.zr}getGlobalsCache(){return this.jr}getMutationQueue(t,e){return Ti.It(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Ka(t,this.serializer.Tt.databaseId)}getDocumentOverlayCache(t){return yi.It(this.serializer,t)}getBundleCache(){return this.Yr}runTransaction(t,e,n){V(he,"Starting transaction:",t);let s=e==="readonly"?"readonly":"readwrite",i=function(l){return l===17?Pg:l===16?bg:l===15?ec:l===14?bd:l===13?Rd:l===12?Rg:l===11?Sd:void M()}(this.di),a;return this.pi.runTransaction(t,s,i,u=>(a=new Mr(u,this.Gr?this.Gr.next():Ct.ae),e==="readwrite-primary"?this.Fi(a).next(l=>!!l||this.Mi(a)).next(l=>{if(!l)throw ot(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ti.enqueueRetryable(()=>this.fi(!1)),new N(P.FAILED_PRECONDITION,pd);return n(a)}).next(l=>this.Oi(a).next(()=>l)):this.ji(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ji(t){return Tr(t).get(un).next(e=>{if(e!==null&&this.ki(e.leaseTimestampMs,Qo)&&!this.$i(e.ownerId)&&!this.Ni(e)&&!(this.Ei||this.allowTabSynchronization&&e.allowTabSynchronization))throw new N(P.FAILED_PRECONDITION,Wo)})}Oi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Tr(t).put(un,e)}static D(){return Rn.D()}xi(t){let e=Tr(t);return e.get(un).next(n=>this.Ni(n)?(V(he,"Releasing primary lease."),e.delete(un)):S.resolve())}ki(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ot(`Detected an update time that is in the future: ${t} > ${n}`),!1))}bi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ri=()=>{this.Ti.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.wi()))},this.document.addEventListener("visibilitychange",this.Ri),this.inForeground=this.document.visibilityState==="visible")}Ui(){this.Ri&&(this.document.removeEventListener("visibilitychange",this.Ri),this.Ri=null)}Si(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ai=()=>{this.Ki();let e=/(?:Version|Mobile)\/1[456]/;Lo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ti.enterRestrictedMode(!0),this.Ti.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ai))}Wi(){this.Ai&&(this.window.removeEventListener("pagehide",this.Ai),this.Ai=null)}$i(t){var e;try{let n=((e=this.yi)===null||e===void 0?void 0:e.getItem(this.Qi(t)))!==null;return V(he,`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ot(he,"Failed to get zombied client id.",n),!1}}Ki(){if(this.yi)try{this.yi.setItem(this.Qi(this.clientId),String(Date.now()))}catch(t){ot("Failed to set zombie client id.",t)}}Gi(){if(this.yi)try{this.yi.removeItem(this.Qi(this.clientId))}catch{}}Qi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Tr(r){return dt(r,us)}function Os(r){return dt(r,Cn)}function bf(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var lu=class r{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Hi=n,this.Ji=s}static Yi(t,e){let n=K(),s=K();for(let i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new r(t,e.fromCache,n,s)}};var hu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var bi=class{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Lo()?8:yd(gr())>0?6:4}()}initialize(t,e){this.ns=t,this.indexManager=e,this.Zi=!0}getDocumentsMatchingQuery(t,e,n,s){let i={result:null};return this.rs(t,e).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ss(t,e,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;let a=new hu;return this._s(t,e,a).next(u=>{if(i.result=u,this.Xi)return this.us(t,e,a,u.size)})}).next(()=>i.result)}us(t,e,n,s){return n.documentReadCount<this.es?(mn()<=Bt.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",gn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),S.resolve()):(mn()<=Bt.DEBUG&&V("QueryEngine","Query:",gn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.ts*s?(mn()<=Bt.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",gn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Dt(e))):S.resolve())}rs(t,e){if(vh(e))return S.resolve(null);let n=Dt(e);return this.indexManager.getIndexType(t,n).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Ra(e,null,"F"),n=Dt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(i=>{let a=K(...i);return this.ns.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.cs(e,u);return this.ls(e,d,a,l.readTime)?this.rs(t,Ra(e,null,"F")):this.hs(t,d,e,l)}))})))}ss(t,e,n,s){return vh(e)||s.isEqual(B.min())?S.resolve(null):this.ns.getDocuments(t,n).next(i=>{let a=this.cs(e,i);return this.ls(e,a,n,s)?S.resolve(null):(mn()<=Bt.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),gn(e)),this.hs(t,a,e,md(s,An)).next(u=>u))})}cs(t,e){let n=new tt(Kd(t));return e.forEach((s,i)=>{hs(t,i)&&(n=n.add(i))}),n}ls(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}_s(t,e,n){return mn()<=Bt.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",gn(e)),this.ns.getDocumentsMatchingQuery(t,e,Ft.min(),n)}hs(t,e,n,s){return this.ns.getDocumentsMatchingQuery(t,n,s).next(i=>(e.forEach(a=>{i=i.insert(a.key,a)}),i))}};var lc="LocalStore",lp=3e8,du=class{constructor(t,e,n,s){this.persistence=t,this.Ps=e,this.serializer=s,this.Ts=new rt(z),this.Is=new Ut(i=>He(i),cs),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(n)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ai(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ts))}};function Pf(r,t,e,n){return new du(r,t,e,n)}function Vf(r,t){return C(this,null,function*(){let e=L(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,e.As(t),e.mutationQueue.getAllMutationBatches(n))).next(i=>{let a=[],u=[],l=K();for(let d of s){a.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}for(let d of i){u.push(d.batchId);for(let m of d.mutations)l=l.add(m.key)}return e.localDocuments.getDocuments(n,l).next(d=>({Rs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function hp(r,t){let e=L(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=t.batch.keys(),i=e.ds.newChangeBuffer({trackRemovals:!0});return function(u,l,d,m){let g=d.batch,T=g.keys(),b=S.resolve();return T.forEach(x=>{b=b.next(()=>m.getEntry(l,x)).next(k=>{let D=d.docVersions.get(x);q(D!==null),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),m.addEntry(k)))})}),b.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,i).next(()=>i.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,s))})}function Cf(r){let t=L(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Hr.getLastRemoteSnapshotVersion(e))}function dp(r,t){let e=L(r),n=t.snapshotVersion,s=e.Ts;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let a=e.ds.newChangeBuffer({trackRemovals:!0});s=e.Ts;let u=[];t.targetChanges.forEach((m,g)=>{let T=s.get(g);if(!T)return;u.push(e.Hr.removeMatchingKeys(i,m.removedDocuments,g).next(()=>e.Hr.addMatchingKeys(i,m.addedDocuments,g)));let b=T.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(g)!==null?b=b.withResumeToken(lt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):m.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(m.resumeToken,n)),s=s.insert(g,b),function(k,D,$){return k.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=lp?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0}(T,b,m)&&u.push(e.Hr.updateTargetData(i,b))});let l=xt(),d=K();if(t.documentUpdates.forEach(m=>{t.resolvedLimboDocuments.has(m)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(i,m))}),u.push(fp(i,a,t.documentUpdates).next(m=>{l=m.Vs,d=m.fs})),!n.isEqual(B.min())){let m=e.Hr.getLastRemoteSnapshotVersion(i).next(g=>e.Hr.setTargetsMetadata(i,i.currentSequenceNumber,n));u.push(m)}return S.waitFor(u).next(()=>a.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,l,d)).next(()=>l)}).then(i=>(e.Ts=s,i))}function fp(r,t,e){let n=K(),s=K();return e.forEach(i=>n=n.add(i)),t.getEntries(r,n).next(i=>{let a=xt();return e.forEach((u,l)=>{let d=i.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),l.isNoDocument()&&l.version.isEqual(B.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):V(lc,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Vs:a,fs:s}})}function mp(r,t){let e=L(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=$e),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Pi(r,t){let e=L(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return e.Hr.getTargetData(n,t).next(i=>i?(s=i,S.resolve(s)):e.Hr.allocateTargetId(n).next(a=>(s=new qn(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Hr.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=e.Ts.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ts=e.Ts.insert(n.targetId,n),e.Is.set(t,n.targetId)),n})}function Bn(r,t,e){return C(this,null,function*(){let n=L(r),s=n.Ts.get(t),i=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!be(a))throw a;V(lc,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ts=n.Ts.remove(t),n.Is.delete(s.target)})}function fu(r,t,e){let n=L(r),s=B.min(),i=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,m){let g=L(l),T=g.Is.get(m);return T!==void 0?S.resolve(g.Ts.get(T)):g.Hr.getTargetData(d,m)}(n,a,Dt(t)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.Hr.getMatchingKeysForTargetId(a,u.targetId).next(l=>{i=l})}).next(()=>n.Ps.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?i:K())).next(u=>(Nf(n,Gd(t),u),{documents:u,gs:i})))}function xf(r,t){let e=L(r),n=L(e.Hr),s=e.Ts.get(t);return s?Promise.resolve(s.target):e.persistence.runTransaction("Get target data","readonly",i=>n.lt(i,t).next(a=>a?a.target:null))}function Df(r,t){let e=L(r),n=e.Es.get(t)||B.min();return e.persistence.runTransaction("Get new document changes","readonly",s=>e.ds.getAllFromCollectionGroup(s,t,md(n,An),Number.MAX_SAFE_INTEGER)).then(s=>(Nf(e,t,s),s))}function Nf(r,t,e){let n=r.Es.get(t)||B.min();e.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.Es.set(t,n)}var kf="firestore_clients";function Hh(r,t){return`${kf}_${r}_${t}`}var Ff="firestore_mutations";function Yh(r,t,e){let n=`${Ff}_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}var Of="firestore_targets";function Ho(r,t){return`${Of}_${r}_${t}`}var jt="SharedClientState",Vi=class r{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static bs(t,e,n){let s=JSON.parse(n),i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new N(s.error.code,s.error.message))),a?new r(t,e,s.state,i):(ot(jt,`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ss(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Vr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static bs(t,e){let n=JSON.parse(e),s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new N(n.error.code,n.error.message))),i?new r(t,n.state,s):(ot(jt,`Failed to parse target state for ID '${t}': ${e}`),null)}Ss(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ci=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static bs(t,e){let n=JSON.parse(e),s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=oc();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=_d(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new r(t,i):(ot(jt,`Failed to parse client data for instance '${t}': ${e}`),null)}},mu=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static bs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ot(jt,`Failed to parse online state: ${t}`),null)}},Hr=class{constructor(){this.activeTargetIds=oc()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Cr=class{constructor(t,e,n,s,i){this.window=t,this.Ti=e,this.persistenceKey=n,this.Cs=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Fs=this.Ms.bind(this),this.xs=new rt(z),this.started=!1,this.Os=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ns=Hh(this.persistenceKey,this.Cs),this.Bs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.xs=this.xs.insert(this.Cs,new Hr),this.Ls=new RegExp(`^${kf}_${a}_([^_]*)$`),this.ks=new RegExp(`^${Ff}_${a}_(\\d+)(?:_(.*))?$`),this.qs=new RegExp(`^${Of}_${a}_(\\d+)$`),this.Qs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.$s=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Fs)}static D(t){return!(!t||!t.localStorage)}start(){return C(this,null,function*(){let t=yield this.syncEngine.zi();for(let n of t){if(n===this.Cs)continue;let s=this.getItem(Hh(this.persistenceKey,n));if(s){let i=Ci.bs(n,s);i&&(this.xs=this.xs.insert(i.clientId,i))}}this.Ks();let e=this.storage.getItem(this.Qs);if(e){let n=this.Us(e);n&&this.Ws(n)}for(let n of this.Os)this.Ms(n);this.Os=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Bs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Gs(this.xs)}isActiveQueryTarget(t){let e=!1;return this.xs.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.zs(t,"pending")}updateMutationState(t,e,n){this.zs(t,e,n),this.js(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let s=this.storage.getItem(Ho(this.persistenceKey,t));if(s){let i=Vr.bs(t,s);i&&(n=i.state)}}return e&&this.Hs.Ds(t),this.Ks(),n}removeLocalQueryTarget(t){this.Hs.vs(t),this.Ks()}isLocalQueryTarget(t){return this.Hs.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Ho(this.persistenceKey,t))}updateQueryState(t,e,n){this.Js(t,e,n)}handleUserChange(t,e,n){e.forEach(s=>{this.js(s)}),this.currentUser=t,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(t){this.Ys(t)}notifyBundleLoaded(t){this.Zs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Fs),this.removeItem(this.Ns),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return V(jt,"READ",t,e),e}setItem(t,e){V(jt,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){V(jt,"REMOVE",t),this.storage.removeItem(t)}Ms(t){let e=t;if(e.storageArea===this.storage){if(V(jt,"EVENT",e.key,e.newValue),e.key===this.Ns)return void ot("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ti.enqueueRetryable(()=>C(this,null,function*(){if(this.started){if(e.key!==null){if(this.Ls.test(e.key)){if(e.newValue==null){let n=this.Xs(e.key);return this.eo(n,null)}{let n=this.no(e.key,e.newValue);if(n)return this.eo(n.clientId,n)}}else if(this.ks.test(e.key)){if(e.newValue!==null){let n=this.ro(e.key,e.newValue);if(n)return this.io(n)}}else if(this.qs.test(e.key)){if(e.newValue!==null){let n=this.so(e.key,e.newValue);if(n)return this.oo(n)}}else if(e.key===this.Qs){if(e.newValue!==null){let n=this.Us(e.newValue);if(n)return this.Ws(n)}}else if(e.key===this.Bs){let n=function(i){let a=Ct.ae;if(i!=null)try{let u=JSON.parse(i);q(typeof u=="number"),a=u}catch(u){ot(jt,"Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ct.ae&&this.sequenceNumberHandler(n)}else if(e.key===this.$s){let n=this._o(e.newValue);yield Promise.all(n.map(s=>this.syncEngine.ao(s)))}}}else this.Os.push(e)}))}}get Hs(){return this.xs.get(this.Cs)}Ks(){this.setItem(this.Ns,this.Hs.Ss())}zs(t,e,n){let s=new Vi(this.currentUser,t,e,n),i=Yh(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Ss())}js(t){let e=Yh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Ys(t){let e={clientId:this.Cs,onlineState:t};this.storage.setItem(this.Qs,JSON.stringify(e))}Js(t,e,n){let s=Ho(this.persistenceKey,t),i=new Vr(t,e,n);this.setItem(s,i.Ss())}Zs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.$s,e)}Xs(t){let e=this.Ls.exec(t);return e?e[1]:null}no(t,e){let n=this.Xs(t);return Ci.bs(n,e)}ro(t,e){let n=this.ks.exec(t),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return Vi.bs(new ft(i),s,e)}so(t,e){let n=this.qs.exec(t),s=Number(n[1]);return Vr.bs(s,e)}Us(t){return mu.bs(t)}_o(t){return JSON.parse(t)}io(t){return C(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.uo(t.batchId,t.state,t.error);V(jt,`Ignoring mutation for non-active user ${t.user.uid}`)})}oo(t){return this.syncEngine.co(t.targetId,t.state,t.error)}eo(t,e){let n=e?this.xs.insert(t,e):this.xs.remove(t),s=this.Gs(this.xs),i=this.Gs(n),a=[],u=[];return i.forEach(l=>{s.has(l)||a.push(l)}),s.forEach(l=>{i.has(l)||u.push(l)}),this.syncEngine.lo(a,u).then(()=>{this.xs=n})}Ws(t){this.xs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Gs(t){let e=oc();return t.forEach((n,s)=>{e=e.unionWith(s.activeTargetIds)}),e}},xi=class{constructor(){this.ho=new Hr,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,e,n){this.Po[t]=e}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new Hr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var gu=class{To(t){}shutdown(){}};var Xh="ConnectivityMonitor",Di=class{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){V(Xh,"Network connectivity changed: AVAILABLE");for(let t of this.Vo)t(0)}Ro(){V(Xh,"Network connectivity changed: UNAVAILABLE");for(let t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ms=null;function pu(){return Ms===null?Ms=function(){return 268435456+Math.round(2147483648*Math.random())}():Ms++,"0x"+Ms.toString(16)}var Yo="RestConnection",gp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},yu=class{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.po=e+"://"+t.host,this.yo=`projects/${n}/databases/${s}`,this.wo=this.databaseId.database===ri?`project_id=${n}`:`project_id=${n}&database_id=${s}`}bo(t,e,n,s,i){let a=pu(),u=this.So(t,e.toUriEncodedString());V(Yo,`Sending RPC '${t}' ${a}:`,u,n);let l={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(l,s,i),this.vo(t,u,l,n).then(d=>(V(Yo,`Received RPC '${t}' ${a}: `,d),d),d=>{throw xr(Yo,`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",n),d})}Co(t,e,n,s,i,a){return this.bo(t,e,n,s,i)}Do(t,e,n){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gn}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,i)=>t[i]=s),n&&n.headers.forEach((s,i)=>t[i]=s)}So(t,e){let n=gp[t];return`${this.po}/v1/${e}:${n}`}terminate(){}};var _u=class{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}};var vt="WebChannelConnection",wu=class extends yu{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,e,n,s){let i=pu();return new Promise((a,u)=>{let l=new Uo;l.setWithCredentials(!0),l.listenOnce(Bo.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case yr.NO_ERROR:let m=l.getResponseJson();V(vt,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(m)),a(m);break;case yr.TIMEOUT:V(vt,`RPC '${t}' ${i} timed out`),u(new N(P.DEADLINE_EXCEEDED,"Request time out"));break;case yr.HTTP_ERROR:let g=l.getStatus();if(V(vt,`RPC '${t}' ${i} failed with status:`,g,"response text:",l.getResponseText()),g>0){let T=l.getResponseJson();Array.isArray(T)&&(T=T[0]);let b=T?.error;if(b&&b.status&&b.message){let x=function(D){let $=D.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf($)>=0?$:P.UNKNOWN}(b.status);u(new N(x,b.message))}else u(new N(P.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new N(P.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{V(vt,`RPC '${t}' ${i} completed.`)}});let d=JSON.stringify(s);V(vt,`RPC '${t}' ${i} sending request:`,s),l.send(e,"POST",d,n,15)})}Wo(t,e,n){let s=pu(),i=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=$o(),u=zo(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Do(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let m=i.join("");V(vt,`Creating RPC '${t}' stream ${s}: ${m}`,l);let g=a.createWebChannel(m,l),T=!1,b=!1,x=new _u({Fo:D=>{b?V(vt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(T||(V(vt,`Opening RPC '${t}' stream ${s} transport.`),g.open(),T=!0),V(vt,`RPC '${t}' stream ${s} sending:`,D),g.send(D))},Mo:()=>g.close()}),k=(D,$,j)=>{D.listen($,U=>{try{j(U)}catch(W){setTimeout(()=>{throw W},0)}})};return k(g,an.EventType.OPEN,()=>{b||(V(vt,`RPC '${t}' stream ${s} transport opened.`),x.Qo())}),k(g,an.EventType.CLOSE,()=>{b||(b=!0,V(vt,`RPC '${t}' stream ${s} transport closed`),x.Ko())}),k(g,an.EventType.ERROR,D=>{b||(b=!0,xr(vt,`RPC '${t}' stream ${s} transport errored:`,D),x.Ko(new N(P.UNAVAILABLE,"The operation could not be completed")))}),k(g,an.EventType.MESSAGE,D=>{var $;if(!b){let j=D.data[0];q(!!j);let U=j,W=U?.error||(($=U[0])===null||$===void 0?void 0:$.error);if(W){V(vt,`RPC '${t}' stream ${s} received error:`,W);let X=W.status,G=function(_){let v=ut[_];if(v!==void 0)return rf(v)}(X),w=W.message;G===void 0&&(G=P.INTERNAL,w="Unknown error status: "+X+" with message "+W.message),b=!0,x.Ko(new N(G,w)),g.close()}else V(vt,`RPC '${t}' stream ${s} received:`,j),x.Uo(j)}}),k(u,jo.STAT_EVENT,D=>{D.stat===Ds.PROXY?V(vt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Ds.NOPROXY&&V(vt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.$o()},0),x}};function Mf(){return typeof window<"u"?window:null}function $s(){return typeof document<"u"?document:null}function no(r){return new Da(r,!0)}var Ni=class{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Ti=t,this.timerId=e,this.Go=n,this.zo=s,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();let e=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),s=Math.max(0,e-n);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ho} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,s,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}};var Jh="PersistentStream",ki=class{constructor(t,e,n,s,i,a,u,l){this.Ti=t,this.n_=n,this.r_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Ni(t,e)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}stop(){return C(this,null,function*(){this.u_()&&(yield this.close(0))})}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}T_(){return C(this,null,function*(){if(this.c_())return this.close(0)})}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}close(t,e){return C(this,null,function*(){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(ot(e.toString()),ot("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Lo(e)})}A_(){}auth(){this.state=1;let t=this.R_(this.i_),e=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.i_===e&&this.V_(n,s)},n=>{t(()=>{let s=new N(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.m_(s)})})}V_(t,e){let n=this.R_(this.i_);this.stream=this.f_(t,e),this.stream.xo(()=>{n(()=>this.listener.xo())}),this.stream.No(()=>{n(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(s=>{n(()=>this.m_(s))}),this.stream.onMessage(s=>{n(()=>++this.__==1?this.g_(s):this.onNext(s))})}l_(){this.state=5,this.a_.Xo(()=>C(this,null,function*(){this.state=0,this.start()}))}m_(t){return V(Jh,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return e=>{this.Ti.enqueueAndForget(()=>this.i_===t?e():(V(Jh,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},vu=class extends ki{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}f_(t,e){return this.connection.Wo("Listen",t,e)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();let e=Zg(this.serializer,t),n=function(i){if(!("targetChange"in i))return B.min();let a=i.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?At(a.readTime):B.min()}(t);return this.listener.p_(e,n)}y_(t){let e={};e.database=Fa(this.serializer),e.addTarget=function(i,a){let u,l=a.target;if(u=oi(l)?{documents:lf(i,l)}:{query:hf(i,l).ht},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=sf(i,a.resumeToken);let d=Na(i,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=Ln(i,a.snapshotVersion.toTimestamp());let d=Na(i,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=ep(this.serializer,t);n&&(e.labels=n),this.I_(e)}w_(t){let e={};e.database=Fa(this.serializer),e.removeTarget=t,this.I_(e)}},Tu=class extends ki{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,e){return this.connection.Wo("Write",t,e)}g_(t){return q(!!t.streamToken),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();let e=tp(t.writeResults,t.commitTime),n=At(t.commitTime);return this.listener.v_(n,e)}C_(){let t={};t.database=Fa(this.serializer),this.I_(t)}S_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>mi(this.serializer,n))};this.I_(e)}};var Iu=class{},Eu=class extends Iu{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.F_=!1}M_(){if(this.F_)throw new N(P.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,e,n,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.bo(t,ka(e,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new N(P.UNKNOWN,i.toString())})}Co(t,e,n,s,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Co(t,ka(e,n),s,a,u,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new N(P.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}},Au=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(ot(e),this.N_=!1):V("OnlineStateTracker",e)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}};var Ze="RemoteStore",Su=class{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(a=>{n.enqueueAndForget(()=>C(this,null,function*(){en(this)&&(V(Ze,"Restarting streams for network reachability change."),yield function(l){return C(this,null,function*(){let d=L(l);d.W_.add(4),yield ds(d),d.j_.set("Unknown"),d.W_.delete(4),yield ro(d)})}(this))}))}),this.j_=new Au(n,s)}};function ro(r){return C(this,null,function*(){if(en(r))for(let t of r.G_)yield t(!0)})}function ds(r){return C(this,null,function*(){for(let t of r.G_)yield t(!1)})}function so(r,t){let e=L(r);e.U_.has(t.targetId)||(e.U_.set(t.targetId,t),fc(e)?dc(e):Qn(e).c_()&&hc(e,t))}function jn(r,t){let e=L(r),n=Qn(e);e.U_.delete(t),n.c_()&&Lf(e,t),e.U_.size===0&&(n.c_()?n.P_():en(e)&&e.j_.set("Unknown"))}function hc(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Qn(r).y_(t)}function Lf(r,t){r.H_.Ne(t),Qn(r).w_(t)}function dc(r){r.H_=new xa({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.U_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),Qn(r).start(),r.j_.B_()}function fc(r){return en(r)&&!Qn(r).u_()&&r.U_.size>0}function en(r){return L(r).W_.size===0}function qf(r){r.H_=void 0}function pp(r){return C(this,null,function*(){r.j_.set("Online")})}function yp(r){return C(this,null,function*(){r.U_.forEach((t,e)=>{hc(r,t)})})}function _p(r,t){return C(this,null,function*(){qf(r),fc(r)?(r.j_.q_(t),dc(r)):r.j_.set("Unknown")})}function wp(r,t,e){return C(this,null,function*(){if(r.j_.set("Online"),t instanceof hi&&t.state===2&&t.cause)try{yield function(s,i){return C(this,null,function*(){let a=i.cause;for(let u of i.targetIds)s.U_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.U_.delete(u),s.H_.removeTarget(u))})}(r,t)}catch(n){V(Ze,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Fi(r,n)}else if(t instanceof Tn?r.H_.We(t):t instanceof li?r.H_.Ze(t):r.H_.je(t),!e.isEqual(B.min()))try{let n=yield Cf(r.localStore);e.compareTo(n)>=0&&(yield function(i,a){let u=i.H_.ot(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let m=i.U_.get(d);m&&i.U_.set(d,m.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let m=i.U_.get(l);if(!m)return;i.U_.set(l,m.withResumeToken(lt.EMPTY_BYTE_STRING,m.snapshotVersion)),Lf(i,l);let g=new qn(m.target,l,d,m.sequenceNumber);hc(i,g)}),i.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){V(Ze,"Failed to raise snapshot:",n),yield Fi(r,n)}})}function Fi(r,t,e){return C(this,null,function*(){if(!be(t))throw t;r.W_.add(1),yield ds(r),r.j_.set("Offline"),e||(e=()=>Cf(r.localStore)),r.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){V(Ze,"Retrying IndexedDB access"),yield e(),r.W_.delete(1),yield ro(r)}))})}function Uf(r,t){return t().catch(e=>Fi(r,e,t))}function Kn(r){return C(this,null,function*(){let t=L(r),e=Ee(t),n=t.K_.length>0?t.K_[t.K_.length-1].batchId:$e;for(;vp(t);)try{let s=yield mp(t.localStore,n);if(s===null){t.K_.length===0&&e.P_();break}n=s.batchId,Tp(t,s)}catch(s){yield Fi(t,s)}Bf(t)&&jf(t)})}function vp(r){return en(r)&&r.K_.length<10}function Tp(r,t){r.K_.push(t);let e=Ee(r);e.c_()&&e.b_&&e.S_(t.mutations)}function Bf(r){return en(r)&&!Ee(r).u_()&&r.K_.length>0}function jf(r){Ee(r).start()}function Ip(r){return C(this,null,function*(){Ee(r).C_()})}function Ep(r){return C(this,null,function*(){let t=Ee(r);for(let e of r.K_)t.S_(e.mutations)})}function Ap(r,t,e){return C(this,null,function*(){let n=r.K_.shift(),s=Pa.from(n,t,e);yield Uf(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),yield Kn(r)})}function Sp(r,t){return C(this,null,function*(){t&&Ee(r).b_&&(yield function(n,s){return C(this,null,function*(){if(function(a){return Gg(a)&&a!==P.ABORTED}(s.code)){let i=n.K_.shift();Ee(n).h_(),yield Uf(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield Kn(n)}})}(r,t)),Bf(r)&&jf(r)})}function Zh(r,t){return C(this,null,function*(){let e=L(r);e.asyncQueue.verifyOperationInProgress(),V(Ze,"RemoteStore received new credentials");let n=en(e);e.W_.add(3),yield ds(e),n&&e.j_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.W_.delete(3),yield ro(e)})}function Ru(r,t){return C(this,null,function*(){let e=L(r);t?(e.W_.delete(2),yield ro(e)):t||(e.W_.add(2),yield ds(e),e.j_.set("Unknown"))})}function Qn(r){return r.J_||(r.J_=function(e,n,s){let i=L(e);return i.M_(),new vu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{xo:pp.bind(null,r),No:yp.bind(null,r),Lo:_p.bind(null,r),p_:wp.bind(null,r)}),r.G_.push(t=>C(this,null,function*(){t?(r.J_.h_(),fc(r)?dc(r):r.j_.set("Unknown")):(yield r.J_.stop(),qf(r))}))),r.J_}function Ee(r){return r.Y_||(r.Y_=function(e,n,s){let i=L(e);return i.M_(),new Tu(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:Ip.bind(null,r),Lo:Sp.bind(null,r),D_:Ep.bind(null,r),v_:Ap.bind(null,r)}),r.G_.push(t=>C(this,null,function*(){t?(r.Y_.h_(),yield Kn(r)):(yield r.Y_.stop(),r.K_.length>0&&(V(Ze,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))}))),r.Y_}var bu=class r{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new kt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){let a=Date.now()+n,u=new r(t,e,a,s,i);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function mc(r,t){if(ot("AsyncQueue",`${t}: ${r}`),be(r))return new N(P.UNAVAILABLE,`${t}: ${r}`);throw r}var Oi=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=Ir(),this.sortedSet=new rt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var Mi=class{constructor(){this.Z_=new rt(O.comparator)}track(t){let e=t.doc.key,n=this.Z_.get(e);n?t.type!==0&&n.type===3?this.Z_=this.Z_.insert(e,t):t.type===3&&n.type!==1?this.Z_=this.Z_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.Z_=this.Z_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.Z_=this.Z_.remove(e):t.type===1&&n.type===2?this.Z_=this.Z_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.Z_=this.Z_.insert(e,{type:2,doc:t.doc}):M():this.Z_=this.Z_.insert(e,t)}X_(){let t=[];return this.Z_.inorderTraversal((e,n)=>{t.push(n)}),t}},zn=class r{constructor(t,e,n,s,i,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Oi.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&eo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}};var Pu=class{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}},Vu=class{constructor(){this.queries=td(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(e,n){let s=L(e),i=s.queries;s.queries=td(),i.forEach((a,u)=>{for(let l of u.ta)l.onError(n)})})(this,new N(P.ABORTED,"Firestore shutting down"))}};function td(){return new Ut(r=>$d(r),eo)}function gc(r,t){return C(this,null,function*(){let e=L(r),n=3,s=t.query,i=e.queries.get(s);i?!i.na()&&t.ra()&&(n=2):(i=new Pu,n=t.ra()?0:1);try{switch(n){case 0:i.ea=yield e.onListen(s,!0);break;case 1:i.ea=yield e.onListen(s,!1);break;case 2:yield e.onFirstRemoteStoreListen(s)}}catch(a){let u=mc(a,`Initialization of query '${gn(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,i),i.ta.push(t),t.sa(e.onlineState),i.ea&&t.oa(i.ea)&&yc(e)})}function pc(r,t){return C(this,null,function*(){let e=L(r),n=t.query,s=3,i=e.queries.get(n);if(i){let a=i.ta.indexOf(t);a>=0&&(i.ta.splice(a,1),i.ta.length===0?s=t.ra()?0:1:!i.na()&&t.ra()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Rp(r,t){let e=L(r),n=!1;for(let s of t){let i=s.query,a=e.queries.get(i);if(a){for(let u of a.ta)u.oa(s)&&(n=!0);a.ea=s}}n&&yc(e)}function bp(r,t,e){let n=L(r),s=n.queries.get(t);if(s)for(let i of s.ta)i.onError(e);n.queries.delete(t)}function yc(r){r.ia.forEach(t=>{t.next()})}var Cu,ed;(ed=Cu||(Cu={}))._a="default",ed.Cache="cache";var Yr=class{constructor(t,e,n){this.query=t,this.aa=e,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(t){if(!this.options.includeMetadataChanges){let n=[];for(let s of t.docChanges)s.type!==3&&n.push(s);t=new zn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ua?this.la(t)&&(this.aa.next(t),e=!0):this.ha(t,this.onlineState)&&(this.Pa(t),e=!0),this.ca=t,e}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let e=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),e=!0),e}ha(t,e){if(!t.fromCache||!this.ra())return!0;let n=e!=="Offline";return(!this.options.Ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}la(t){if(t.docChanges.length>0)return!0;let e=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}Pa(t){t=zn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==Cu.Cache}};var Li=class{constructor(t){this.key=t}},qi=class{constructor(t){this.key=t}},xu=class{constructor(t,e){this.query=t,this.fa=e,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=K(),this.mutatedKeys=K(),this.ya=Kd(t),this.wa=new Oi(this.ya)}get ba(){return this.fa}Sa(t,e){let n=e?e.Da:new Mi,s=e?e.wa:this.wa,i=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1,l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((m,g)=>{let T=s.get(m),b=hs(this.query,g)?g:null,x=!!T&&this.mutatedKeys.has(T.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),D=!1;T&&b?T.data.isEqual(b.data)?x!==k&&(n.track({type:3,doc:b}),D=!0):this.va(T,b)||(n.track({type:2,doc:b}),D=!0,(l&&this.ya(b,l)>0||d&&this.ya(b,d)<0)&&(u=!0)):!T&&b?(n.track({type:0,doc:b}),D=!0):T&&!b&&(n.track({type:1,doc:T}),D=!0,(l||d)&&(u=!0)),D&&(b?(a=a.add(b),i=k?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{wa:a,Da:n,ls:u,mutatedKeys:i}}va(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){let i=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;let a=t.Da.X_();a.sort((m,g)=>function(b,x){let k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return k(b)-k(x)}(m.type,g.type)||this.ya(m.doc,g.doc)),this.Ca(n),s=s!=null&&s;let u=e&&!s?this.Fa():[],l=this.pa.size===0&&this.current&&!s?1:0,d=l!==this.ga;return this.ga=l,a.length!==0||d?{snapshot:new zn(this.query,t.wa,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:u}:{Ma:u}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Mi,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(e=>this.fa=this.fa.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.fa=this.fa.delete(e)),this.current=t.current)}Fa(){if(!this.current)return[];let t=this.pa;this.pa=K(),this.wa.forEach(n=>{this.xa(n.key)&&(this.pa=this.pa.add(n.key))});let e=[];return t.forEach(n=>{this.pa.has(n)||e.push(new qi(n))}),this.pa.forEach(n=>{t.has(n)||e.push(new Li(n))}),e}Oa(t){this.fa=t.gs,this.pa=K();let e=this.Sa(t.documents);return this.applyChanges(e,!0)}Na(){return zn.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}},Wn="SyncEngine",Du=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},Nu=class{constructor(t){this.key=t,this.Ba=!1}},ku=class{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new Ut(u=>$d(u),eo),this.qa=new Map,this.Qa=new Set,this.$a=new rt(O.comparator),this.Ka=new Map,this.Ua=new Qr,this.Wa={},this.Ga=new Map,this.za=Un.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}};function Pp(r,t,e=!0){return C(this,null,function*(){let n=io(r),s,i=n.ka.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Na()):s=yield zf(n,t,e,!0),s})}function Vp(r,t){return C(this,null,function*(){let e=io(r);yield zf(e,t,!0,!1)})}function zf(r,t,e,n){return C(this,null,function*(){let s=yield Pi(r.localStore,Dt(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e),u;return n&&(u=yield _c(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&so(r.remoteStore,s),u})}function _c(r,t,e,n,s){return C(this,null,function*(){r.Ha=(g,T,b)=>function(k,D,$,j){return C(this,null,function*(){let U=D.view.Sa($);U.ls&&(U=yield fu(k.localStore,D.query,!1).then(({documents:w})=>D.view.Sa(w,U)));let W=j&&j.targetChanges.get(D.targetId),X=j&&j.targetMismatches.get(D.targetId)!=null,G=D.view.applyChanges(U,k.isPrimaryClient,W,X);return Fu(k,D.targetId,G.Ma),G.snapshot})}(r,g,T,b);let i=yield fu(r.localStore,t,!0),a=new xu(t,i.gs),u=a.Sa(i.documents),l=Gr.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(u,r.isPrimaryClient,l);Fu(r,e,d.Ma);let m=new Du(t,e,a);return r.ka.set(t,m),r.qa.has(e)?r.qa.get(e).push(t):r.qa.set(e,[t]),d.snapshot})}function Cp(r,t,e){return C(this,null,function*(){let n=L(r),s=n.ka.get(t),i=n.qa.get(s.targetId);if(i.length>1)return n.qa.set(s.targetId,i.filter(a=>!eo(a,t))),void n.ka.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Bn(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),e&&jn(n.remoteStore,s.targetId),$n(n,s.targetId)}).catch(Re))):($n(n,s.targetId),yield Bn(n.localStore,s.targetId,!0))})}function xp(r,t){return C(this,null,function*(){let e=L(r),n=e.ka.get(t),s=e.qa.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),jn(e.remoteStore,n.targetId))})}function Dp(r,t,e){return C(this,null,function*(){let n=Ic(r);try{let s=yield function(a,u){let l=L(a),d=at.now(),m=u.reduce((b,x)=>b.add(x.key),K()),g,T;return l.persistence.runTransaction("Locally write mutations","readwrite",b=>{let x=xt(),k=K();return l.ds.getEntries(b,m).next(D=>{x=D,x.forEach(($,j)=>{j.isValidDocument()||(k=k.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(b,x)).next(D=>{g=D;let $=[];for(let j of u){let U=$g(j,g.get(j.key).overlayedDocument);U!=null&&$.push(new Wt(j.key,U,Od(U.value.mapValue),Nt.exists(!0)))}return l.mutationQueue.addMutationBatch(b,d,$,u)}).next(D=>{T=D;let $=D.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(b,D.batchId,$)})}).then(()=>({batchId:T.batchId,changes:Wd(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),function(a,u,l){let d=a.Wa[a.currentUser.toKey()];d||(d=new rt(z)),d=d.insert(u,l),a.Wa[a.currentUser.toKey()]=d}(n,s.batchId,e),yield Pe(n,s.changes),yield Kn(n.remoteStore)}catch(s){let i=mc(s,"Failed to persist write");e.reject(i)}})}function $f(r,t){return C(this,null,function*(){let e=L(r);try{let n=yield dp(e.localStore,t);t.targetChanges.forEach((s,i)=>{let a=e.Ka.get(i);a&&(q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.Ba=!0:s.modifiedDocuments.size>0?q(a.Ba):s.removedDocuments.size>0&&(q(a.Ba),a.Ba=!1))}),yield Pe(e,n,t)}catch(n){yield Re(n)}})}function nd(r,t,e){let n=L(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let s=[];n.ka.forEach((i,a)=>{let u=a.view.sa(t);u.snapshot&&s.push(u.snapshot)}),function(a,u){let l=L(a);l.onlineState=u;let d=!1;l.queries.forEach((m,g)=>{for(let T of g.ta)T.sa(u)&&(d=!0)}),d&&yc(l)}(n.eventManager,t),s.length&&n.La.p_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Np(r,t,e){return C(this,null,function*(){let n=L(r);n.sharedClientState.updateQueryState(t,"rejected",e);let s=n.Ka.get(t),i=s&&s.key;if(i){let a=new rt(O.comparator);a=a.insert(i,gt.newNoDocument(i,B.min()));let u=K().add(i),l=new $r(B.min(),new Map,new rt(z),a,u);yield $f(n,l),n.$a=n.$a.remove(i),n.Ka.delete(t),Tc(n)}else yield Bn(n.localStore,t,!1).then(()=>$n(n,t,e)).catch(Re)})}function kp(r,t){return C(this,null,function*(){let e=L(r),n=t.batch.batchId;try{let s=yield hp(e.localStore,t);vc(e,n,null),wc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield Pe(e,s)}catch(s){yield Re(s)}})}function Fp(r,t,e){return C(this,null,function*(){let n=L(r);try{let s=yield function(a,u){let l=L(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null),m=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,m,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>l.localDocuments.getDocuments(d,m))})}(n.localStore,t);vc(n,t,e),wc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield Pe(n,s)}catch(s){yield Re(s)}})}function wc(r,t){(r.Ga.get(t)||[]).forEach(e=>{e.resolve()}),r.Ga.delete(t)}function vc(r,t,e){let n=L(r),s=n.Wa[n.currentUser.toKey()];if(s){let i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Wa[n.currentUser.toKey()]=s}}function $n(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.qa.get(t))r.ka.delete(n),e&&r.La.Ja(n,e);r.qa.delete(t),r.isPrimaryClient&&r.Ua.Sr(t).forEach(n=>{r.Ua.containsKey(n)||Gf(r,n)})}function Gf(r,t){r.Qa.delete(t.path.canonicalString());let e=r.$a.get(t);e!==null&&(jn(r.remoteStore,e),r.$a=r.$a.remove(t),r.Ka.delete(e),Tc(r))}function Fu(r,t,e){for(let n of e)n instanceof Li?(r.Ua.addReference(n.key,t),Op(r,n)):n instanceof qi?(V(Wn,"Document no longer in limbo: "+n.key),r.Ua.removeReference(n.key,t),r.Ua.containsKey(n.key)||Gf(r,n.key)):M()}function Op(r,t){let e=t.key,n=e.path.canonicalString();r.$a.get(e)||r.Qa.has(n)||(V(Wn,"New document in limbo: "+e),r.Qa.add(n),Tc(r))}function Tc(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){let t=r.Qa.values().next().value;r.Qa.delete(t);let e=new O(Z.fromString(t)),n=r.za.next();r.Ka.set(n,new Nu(e)),r.$a=r.$a.insert(e,n),so(r.remoteStore,new qn(Dt(ls(e.path)),n,"TargetPurposeLimboResolution",Ct.ae))}}function Pe(r,t,e){return C(this,null,function*(){let n=L(r),s=[],i=[],a=[];n.ka.isEmpty()||(n.ka.forEach((u,l)=>{a.push(n.Ha(l,t,e).then(d=>{var m;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(m=e?.targetChanges.get(l.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){s.push(d);let g=lu.Yi(l.targetId,d);i.push(g)}}))}),yield Promise.all(a),n.La.p_(s),yield function(l,d){return C(this,null,function*(){let m=L(l);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,T=>S.forEach(T.Hi,b=>m.persistence.referenceDelegate.addReference(g,T.targetId,b)).next(()=>S.forEach(T.Ji,b=>m.persistence.referenceDelegate.removeReference(g,T.targetId,b)))))}catch(g){if(!be(g))throw g;V(lc,"Failed to update sequence numbers: "+g)}for(let g of d){let T=g.targetId;if(!g.fromCache){let b=m.Ts.get(T),x=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(x);m.Ts=m.Ts.insert(T,k)}}})}(n.localStore,i))})}function Mp(r,t){return C(this,null,function*(){let e=L(r);if(!e.currentUser.isEqual(t)){V(Wn,"User change. New user:",t.toKey());let n=yield Vf(e.localStore,t);e.currentUser=t,function(i,a){i.Ga.forEach(u=>{u.forEach(l=>{l.reject(new N(P.CANCELLED,a))})}),i.Ga.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield Pe(e,n.Rs)}})}function Lp(r,t){let e=L(r),n=e.Ka.get(t);if(n&&n.Ba)return K().add(n.key);{let s=K(),i=e.qa.get(t);if(!i)return s;for(let a of i){let u=e.ka.get(a);s=s.unionWith(u.view.ba)}return s}}function qp(r,t){return C(this,null,function*(){let e=L(r),n=yield fu(e.localStore,t.query,!0),s=t.view.Oa(n);return e.isPrimaryClient&&Fu(e,t.targetId,s.Ma),s})}function Up(r,t){return C(this,null,function*(){let e=L(r);return Df(e.localStore,t).then(n=>Pe(e,n))})}function Bp(r,t,e,n){return C(this,null,function*(){let s=L(r),i=yield function(u,l){let d=L(u),m=L(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>m.Ln(g,l).next(T=>T?d.localDocuments.getDocuments(g,T):S.resolve(null)))}(s.localStore,t);i!==null?(e==="pending"?yield Kn(s.remoteStore):e==="acknowledged"||e==="rejected"?(vc(s,t,n||null),wc(s,t),function(u,l){L(L(u).mutationQueue).qn(l)}(s.localStore,t)):M(),yield Pe(s,i)):V(Wn,"Cannot apply mutation batch with id: "+t)})}function jp(r,t){return C(this,null,function*(){let e=L(r);if(io(e),Ic(e),t===!0&&e.ja!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),s=yield rd(e,n.toArray());e.ja=!0,yield Ru(e.remoteStore,!0);for(let i of s)so(e.remoteStore,i)}else if(t===!1&&e.ja!==!1){let n=[],s=Promise.resolve();e.qa.forEach((i,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>($n(e,a),Bn(e.localStore,a,!0))),jn(e.remoteStore,a)}),yield s,yield rd(e,n),function(a){let u=L(a);u.Ka.forEach((l,d)=>{jn(u.remoteStore,d)}),u.Ua.Dr(),u.Ka=new Map,u.$a=new rt(O.comparator)}(e),e.ja=!1,yield Ru(e.remoteStore,!1)}})}function rd(r,t,e){return C(this,null,function*(){let n=L(r),s=[],i=[];for(let a of t){let u,l=n.qa.get(a);if(l&&l.length!==0){u=yield Pi(n.localStore,Dt(l[0]));for(let d of l){let m=n.ka.get(d),g=yield qp(n,m);g.snapshot&&i.push(g.snapshot)}}else{let d=yield xf(n.localStore,a);u=yield Pi(n.localStore,d),yield _c(n,Kf(d),a,!1,u.resumeToken)}s.push(u)}return n.La.p_(i),s})}function Kf(r){return jd(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function zp(r){return function(e){return L(L(e).persistence).zi()}(L(r).localStore)}function $p(r,t,e,n){return C(this,null,function*(){let s=L(r);if(s.ja)return void V(Wn,"Ignoring unexpected query state notification.");let i=s.qa.get(t);if(i&&i.length>0)switch(e){case"current":case"not-current":{let a=yield Df(s.localStore,Gd(i[0])),u=$r.createSynthesizedRemoteEventForCurrentChange(t,e==="current",lt.EMPTY_BYTE_STRING);yield Pe(s,a,u);break}case"rejected":yield Bn(s.localStore,t,!0),$n(s,t,n);break;default:M()}})}function Gp(r,t,e){return C(this,null,function*(){let n=io(r);if(n.ja){for(let s of t){if(n.qa.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){V(Wn,"Adding an already active target "+s);continue}let i=yield xf(n.localStore,s),a=yield Pi(n.localStore,i);yield _c(n,Kf(i),a.targetId,!1,a.resumeToken),so(n.remoteStore,a)}for(let s of e)n.qa.has(s)&&(yield Bn(n.localStore,s,!1).then(()=>{jn(n.remoteStore,s),$n(n,s)}).catch(Re))}})}function io(r){let t=L(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=$f.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Lp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Np.bind(null,t),t.La.p_=Rp.bind(null,t.eventManager),t.La.Ja=bp.bind(null,t.eventManager),t}function Ic(r){let t=L(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=kp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Fp.bind(null,t),t}var Ec=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){this.serializer=no(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),yield this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)})}tu(e,n){return null}nu(e,n){return null}eu(e){return Pf(this.persistence,new bi,e.initialUser,this.serializer)}Xa(e){return new Wr(Si.ri,this.serializer)}Za(e){return new xi}terminate(){return C(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Ou=class extends Ec{constructor(t){super(),this.cacheSizeBytes=t}tu(t,e){q(this.persistence.referenceDelegate instanceof Ri);let n=this.persistence.referenceDelegate.garbageCollector;return new Ii(n,t.asyncQueue,e)}Xa(t){let e=this.cacheSizeBytes!==void 0?Rt.withCacheSize(this.cacheSizeBytes):Rt.DEFAULT;return new Wr(n=>Ri.ri(n,e),this.serializer)}},Ui=class r extends Ec{constructor(t,e,n){super(),this.ru=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){yield Oo(r.prototype,this,"initialize").call(this,t),yield this.ru.initialize(this,t),yield Ic(this.ru.syncEngine),yield Kn(this.ru.remoteStore),yield this.persistence.Ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}eu(t){return Pf(this.persistence,new bi,t.initialUser,this.serializer)}tu(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new Ii(n,t.asyncQueue,e)}nu(t,e){let n=new ua(e,this.persistence);return new aa(t.asyncQueue,n)}Xa(t){let e=bf(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Rt.withCacheSize(this.cacheSizeBytes):Rt.DEFAULT;return new cu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Mf(),$s(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Za(t){return new xi}},Mu=class r extends Ui{constructor(t,e){super(t,e,!1),this.ru=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return C(this,null,function*(){yield Oo(r.prototype,this,"initialize").call(this,t);let e=this.ru.syncEngine;this.sharedClientState instanceof Cr&&(this.sharedClientState.syncEngine={uo:Bp.bind(null,e),co:$p.bind(null,e),lo:Gp.bind(null,e),zi:zp.bind(null,e),ao:Up.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.Ci(n=>C(this,null,function*(){yield jp(this.ru.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Za(t){let e=Mf();if(!Cr.D(e))throw new N(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=bf(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Cr(e,t.asyncQueue,n,t.clientId,t.initialUser)}},Ac=(()=>{class r{initialize(e,n){return C(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>nd(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Mp.bind(null,this.syncEngine),yield Ru(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Vu}()}createDatastore(e){let n=no(e.databaseInfo.databaseId),s=function(a){return new wu(a)}(e.databaseInfo);return function(a,u,l,d){return new Eu(a,u,l,d)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return function(s,i,a,u,l){return new Su(s,i,a,u,l)}(this.localStore,this.datastore,e.asyncQueue,n=>nd(this.syncEngine,n,0),function(){return Di.D()?new Di:new gu}())}createSyncEngine(e,n){return function(i,a,u,l,d,m,g){let T=new ku(i,a,u,l,d,m);return g&&(T.ja=!0),T}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return C(this,null,function*(){var e,n;yield function(i){return C(this,null,function*(){let a=L(i);V(Ze,"RemoteStore shutting down."),a.W_.add(5),yield ds(a),a.z_.shutdown(),a.j_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();var Xr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):ot("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Ae="FirestoreClient",Lu=class{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=ft.UNAUTHENTICATED,this.clientId=Ks.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,a=>C(this,null,function*(){V(Ae,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(V(Ae,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new kt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=mc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Xo(r,t){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),V(Ae,"Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(s=>C(this,null,function*(){n.isEqual(s)||(yield Vf(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function sd(r,t){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield Kp(r);V(Ae,"Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Zh(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Zh(t.remoteStore,s)),r._onlineComponents=t})}function Kp(r){return C(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){V(Ae,"Using user provided OfflineComponentProvider");try{yield Xo(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(e))throw e;xr("Error using user provided cache. Falling back to memory cache: "+e),yield Xo(r,new Ec)}}else V(Ae,"Using default OfflineComponentProvider"),yield Xo(r,new Ou(void 0));return r._offlineComponents})}function Qf(r){return C(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(V(Ae,"Using user provided OnlineComponentProvider"),yield sd(r,r._uninitializedComponentsProvider._online)):(V(Ae,"Using default OnlineComponentProvider"),yield sd(r,new Ac))),r._onlineComponents})}function Qp(r){return Qf(r).then(t=>t.syncEngine)}function Bi(r){return C(this,null,function*(){let t=yield Qf(r),e=t.eventManager;return e.onListen=Pp.bind(null,t.syncEngine),e.onUnlisten=Cp.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Vp.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=xp.bind(null,t.syncEngine),e})}function Wp(r,t,e={}){let n=new kt;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,a,u,l,d){let m=new Xr({next:T=>{m.su(),a.enqueueAndForget(()=>pc(i,g));let b=T.docs.has(u);!b&&T.fromCache?d.reject(new N(P.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&T.fromCache&&l&&l.source==="server"?d.reject(new N(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(T)},error:T=>d.reject(T)}),g=new Yr(ls(u.path),m,{includeMetadataChanges:!0,Ta:!0});return gc(i,g)}(yield Bi(r),r.asyncQueue,t,e,n)})),n.promise}function Hp(r,t,e={}){let n=new kt;return r.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return function(i,a,u,l,d){let m=new Xr({next:T=>{m.su(),a.enqueueAndForget(()=>pc(i,g)),T.fromCache&&l.source==="server"?d.reject(new N(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(T)},error:T=>d.reject(T)}),g=new Yr(u,m,{includeMetadataChanges:!0,Ta:!0});return gc(i,g)}(yield Bi(r),r.asyncQueue,t,e,n)})),n.promise}function Wf(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var id=new Map;function Hf(r,t,e){if(!e)throw new N(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Yp(r,t,e,n){if(t===!0&&n===!0)throw new N(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function od(r){if(!O.isDocumentKey(r))throw new N(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ad(r){if(O.isDocumentKey(r))throw new N(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function oo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":M()}function Kt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new N(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=oo(r);throw new N(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}var Xp="firestore.googleapis.com",ud=!0,ji=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new N(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Xp,this.ssl=ud}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:ud;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=vf;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Af)throw new N(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Yp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Wf((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new N(P.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Jr=class{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ji({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new N(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ji(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Zo;switch(n.type){case"firstParty":return new na(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new N(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=id.get(e);n&&(V("ComponentProvider","Removing Datastore"),id.delete(e),n.terminate())}(this),Promise.resolve()}};var Se=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},St=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new me(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},me=class r extends Se{constructor(t,e,n){super(t,e,ls(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new St(this.firestore,null,new O(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function Yf(r,t,...e){if(r=ue(r),Hf("collection","path",t),r instanceof Jr){let n=Z.fromString(t,...e);return ad(n),new me(r,null,n)}{if(!(r instanceof St||r instanceof me))throw new N(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Z.fromString(t,...e));return ad(n),new me(r.firestore,null,n)}}function Xf(r,t,...e){if(r=ue(r),arguments.length===1&&(t=Ks.newId()),Hf("doc","path",t),r instanceof Jr){let n=Z.fromString(t,...e);return od(n),new St(r,null,new O(n))}{if(!(r instanceof St||r instanceof me))throw new N(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(Z.fromString(t,...e));return od(n),new St(r.firestore,r instanceof me?r.converter:null,new O(n))}}var cd="AsyncQueue",zi=class{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Ni(this,"async_queue_retry"),this.bu=()=>{let n=$s();n&&V(cd,"Visibility state changed to "+n.visibilityState),this.a_.t_()},this.Su=t;let e=$s();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;let e=$s();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});let e=new kt;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}Cu(){return C(this,null,function*(){if(this.Vu.length!==0){try{yield this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!be(t))throw t;V(cd,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}})}vu(t){let e=this.Su.then(()=>(this.pu=!0,t().catch(n=>{this.gu=n,this.pu=!1;let s=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw ot("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.pu=!1,n))));return this.Su=e,e}enqueueAfterDelay(t,e,n){this.Du(),this.wu.indexOf(t)>-1&&(e=0);let s=bu.createAndSchedule(this,t,e,n,i=>this.Fu(i));return this.fu.push(s),s}Du(){this.gu&&M()}verifyOperationInProgress(){}Mu(){return C(this,null,function*(){let t;do t=this.Su,yield t;while(t!==this.Su)})}xu(t){for(let e of this.fu)if(e.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.fu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){let e=this.fu.indexOf(t);this.fu.splice(e,1)}};function ld(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let s=e;for(let i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}var re=class extends Jr{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new zi,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new zi(t),this._firestoreClient=void 0,yield t}})}};function Jf(r,t,e){e||(e=ri);let n=Bl(r,"firestore");if(n.isInitialized(e)){let s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(Ml(i,t))return s;throw new N(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new N(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Af)throw new N(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t,instanceIdentifier:e})}function ao(r){if(r._terminated)throw new N(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Jp(r),r._firestoreClient}function Jp(r){var t,e,n;let s=r._freezeSettings(),i=function(u,l,d,m){return new da(u,l,d,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Wf(m.experimentalLongPollingOptions),m.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new Lu(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(r._componentsProvider))}var Zr=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(lt.fromBase64String(t))}catch(e){throw new N(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(lt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var ts=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new N(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ht(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var es=class{constructor(t){this._methodName=t}};var ns=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new N(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new N(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}};var rs=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,t._values)}};var Zp=/^__.*__$/,qu=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Wt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ie(t,this.data,e,this.fieldTransforms)}};function Zf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}var Uu=class r{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ku({path:n,Qu:!1});return s.$u(t),s}Ku(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ku({path:n,Qu:!1});return s.Bu(),s}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return $i(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Zf(this.Lu)&&Zp.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}},Bu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||no(t)}ju(t,e,n,s=!1){return new Uu({Lu:t,methodName:e,zu:n,path:ht.emptyPath(),Qu:!1,Gu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function tm(r){let t=r._freezeSettings(),e=no(r._databaseId);return new Bu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ty(r,t,e,n,s,i={}){let a=r.ju(i.merge||i.mergeFields?2:0,t,e,s);rm("Data must be an object, but it was:",a,n);let u=em(n,a),l,d;if(i.merge)l=new qt(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){let m=[];for(let g of i.mergeFields){let T=ny(t,g,e);if(!a.contains(T))throw new N(P.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);sy(m,T)||m.push(T)}l=new qt(m),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new qu(new Vt(u),l,d)}var ju=class r extends es{_toFieldTransform(t){return new ui(t.path,new we)}isEqual(t){return t instanceof r}};function ey(r,t,e,n=!1){return Sc(e,r.ju(n?4:3,t))}function Sc(r,t){if(nm(r=ue(r)))return rm("Unsupported field value:",t,r),em(r,t);if(r instanceof es)return function(n,s){if(!Zf(s.Lu))throw s.Wu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Wu(`${n._methodName}() is not currently supported inside arrays`);let i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(n,s){let i=[],a=0;for(let u of n){let l=Sc(u,s.Uu(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}}(r,t)}return function(n,s){if((n=ue(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return qg(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let i=at.fromDate(n);return{timestampValue:Ln(s.serializer,i)}}if(n instanceof at){let i=new at(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ln(s.serializer,i)}}if(n instanceof ns)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Zr)return{bytesValue:sf(s.serializer,n._byteString)};if(n instanceof St){let i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Wu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:uc(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof rs)return function(a,u){return{mapValue:{fields:{[rc]:{stringValue:sc},[Dn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.Wu("VectorValues must only contain numeric values.");return ac(u.serializer,d)})}}}}}}(n,s);throw s.Wu(`Unsupported field value: ${oo(n)}`)}(r,t)}function em(r,t){let e={};return Pd(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tn(r,(n,s)=>{let i=Sc(s,t.qu(n));i!=null&&(e[n]=i)}),{mapValue:{fields:e}}}function nm(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof at||r instanceof ns||r instanceof Zr||r instanceof St||r instanceof es||r instanceof rs)}function rm(r,t,e){if(!nm(e)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(e)){let n=oo(e);throw n==="an object"?t.Wu(r+" a custom object"):t.Wu(r+" "+n)}}function ny(r,t,e){if((t=ue(t))instanceof ts)return t._internalPath;if(typeof t=="string")return sm(r,t);throw $i("Field path arguments must be of type string or ",r,!1,void 0,e)}var ry=new RegExp("[~\\*/\\[\\]]");function sm(r,t,e){if(t.search(ry)>=0)throw $i(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new ts(...t.split("."))._internalPath}catch{throw $i(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function $i(r,t,e,n,s){let i=n&&!n.isEmpty(),a=s!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new N(P.INVALID_ARGUMENT,u+r+l)}function sy(r,t){return r.some(e=>e.isEqual(t))}var Gi=class{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new St(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new zu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(uo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},zu=class extends Gi{data(){return super.data()}};function uo(r,t){return typeof t=="string"?sm(r,t):t instanceof ts?t._internalPath:t._delegate._internalPath}function im(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new N(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ss=class{},Ki=class extends ss{};function om(r,t,...e){let n=[];t instanceof ss&&n.push(t),n=n.concat(e),function(i){let a=i.filter(l=>l instanceof os).length,u=i.filter(l=>l instanceof is).length;if(a>1||a>0&&u>0)throw new N(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)r=s._apply(r);return r}var is=class r extends Ki{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return cm(t._query,e),new Se(t.firestore,t.converter,Sa(t._query,e))}_parse(t){let e=tm(t.firestore);return function(i,a,u,l,d,m,g){let T;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new N(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){dd(g,m);let x=[];for(let k of g)x.push(hd(l,i,k));T={arrayValue:{values:x}}}else T=hd(l,i,g)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||dd(g,m),T=ey(u,a,g,m==="in"||m==="not-in");return Q.create(d,m,T)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function am(r,t,e){let n=t,s=uo("where",r);return is._create(s,n,e)}var os=class r extends ss{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:J.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(s,i){let a=s,u=i.getFlattenedFilters();for(let l of u)cm(a,l),a=Sa(a,l)}(t._query,e),new Se(t.firestore,t.converter,Sa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function um(...r){return r.forEach(t=>oy("or",t)),os._create("or",r)}var $u=class r extends Ki{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(s,i,a){if(s.startAt!==null)throw new N(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new N(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new We(i,a)}(t._query,this._field,this._direction);return new Se(t.firestore,t.converter,function(s,i){let a=s.explicitOrderBy.concat([i]);return new _e(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,e))}};function iy(r,t="asc"){let e=t,n=uo("orderBy",r);return $u._create(n,e)}function hd(r,t,e){if(typeof(e=ue(e))=="string"){if(e==="")throw new N(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zd(t)&&e.indexOf("/")!==-1)throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(Z.fromString(e));if(!O.isDocumentKey(n))throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ur(r,new O(n))}if(e instanceof St)return Ur(r,e._key);throw new N(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${oo(e)}.`)}function dd(r,t){if(!Array.isArray(r)||r.length===0)throw new N(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cm(r,t){let e=function(s,i){for(let a of s)for(let u of a.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new N(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new N(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function oy(r,t){if(!(t instanceof is||t instanceof os))throw new N(P.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var Gu=class{convertValue(t,e="none"){switch(ge(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ne(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw M()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return tn(t,(s,i)=>{n[s]=this.convertValue(i,e)}),n}convertVectorValue(t){var e,n,s;let i=(s=(n=(e=t.fields)===null||e===void 0?void 0:e[Dn].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(a=>st(a.doubleValue));return new rs(i)}convertGeoPoint(t){return new ns(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Zi(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Lr(t));default:return null}}convertTimestamp(t){let e=ee(t);return new at(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=Z.fromString(t);q(gf(n));let s=new xn(n.get(1),n.get(3)),i=new O(n.popFirst(5));return s.isEqual(e)||ot(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}};function ay(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var je=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Qi=class extends Gi{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new In(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(uo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},In=class extends Qi{data(t={}){return super.data(t)}},Wi=class{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new je(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new In(this._firestore,this._userDataWriter,n.key,n,new je(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new N(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{let l=new In(s._firestore,s._userDataWriter,u.doc.key,u.doc,new je(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>i||u.type!==3).map(u=>{let l=new In(s._firestore,s._userDataWriter,u.doc.key,u.doc,new je(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter),d=-1,m=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),m=a.indexOf(u.doc.key)),{type:uy(u.type),doc:l,oldIndex:d,newIndex:m}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function uy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}function cy(r){r=Kt(r,St);let t=Kt(r.firestore,re);return Wp(ao(t),r._key).then(e=>mm(t,r,e))}var as=class extends Gu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new St(this.firestore,null,e)}};function lm(r){r=Kt(r,Se);let t=Kt(r.firestore,re),e=ao(t),n=new as(t);return im(r._query),Hp(e,r._query).then(s=>new Wi(t,n,r,s))}function hm(r,t,e){r=Kt(r,St);let n=Kt(r.firestore,re),s=ay(r.converter,t,e);return fm(n,[ty(tm(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,Nt.none())])}function dm(r){return fm(Kt(r.firestore,re),[new Mn(r._key,Nt.none())])}function Rc(r,...t){var e,n,s;r=ue(r);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||ld(t[a])||(i=t[a],a++);let u={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(ld(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(s=g.complete)===null||s===void 0?void 0:s.bind(g)}let l,d,m;if(r instanceof St)d=Kt(r.firestore,re),m=ls(r._key.path),l={next:g=>{t[a]&&t[a](mm(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=Kt(r,Se);d=Kt(g.firestore,re),m=g._query;let T=new as(d);l={next:b=>{t[a]&&t[a](new Wi(d,T,g,b))},error:t[a+1],complete:t[a+2]},im(r._query)}return function(T,b,x,k){let D=new Xr(k),$=new Yr(b,D,x);return T.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return gc(yield Bi(T),$)})),()=>{D.su(),T.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return pc(yield Bi(T),$)}))}}(ao(d),m,u,l)}function fm(r,t){return function(n,s){let i=new kt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){return Dp(yield Qp(n),s,i)})),i.promise}(ao(r),t)}function mm(r,t,e){let n=e.docs.get(t._key),s=new as(r);return new Qi(r,s,t._key,n,new je(e.hasPendingWrites,e.fromCache),t.converter)}var Ku=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=ly(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}};function Ny(r){return new Ku(r)}var Qu=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Ac.provider,this._offlineComponentProvider={build:e=>new Ui(e,t?.cacheSizeBytes,this.forceOwnership)}}},Wu=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Ac.provider,this._offlineComponentProvider={build:e=>new Mu(e,t?.cacheSizeBytes)}}};function ly(r){return new Qu(r?.forceOwnership)}function ky(){return new Wu}function Fy(){return new ju("serverTimestamp")}(function(t,e=!0){(function(s){Gn=s})(zl),Ul(new Ll("firestore",(n,{instanceIdentifier:s,options:i})=>{let a=n.getProvider("app").getImmediate(),u=new re(new ta(n.getProvider("auth-internal")),new ra(a,n.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new N(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(d.options.projectId,m)}(a,s),a);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),pr(th,eh,t),pr(th,eh,"esm2017")})();var co=function(){return co=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},co.apply(this,arguments)};var fy={includeMetadataChanges:!1};function gm(r,t){return t===void 0&&(t=fy),new Cl(function(e){var n=Rc(r,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:n}})}function pm(r,t){var e;t===void 0&&(t={});var n=r.data(t);return!r.exists()||typeof n!="object"||n===null||!t.idField?n:co(co({},n),(e={},e[t.idField]=r.id,e))}function ym(r){return gm(r,{includeMetadataChanges:!0}).pipe(Mo(function(t){return t.docs}))}function _m(r,t){return t===void 0&&(t={}),ym(r).pipe(Mo(function(e){return e.map(function(n){return pm(n,t)})}))}var fs=class{constructor(t){return t}},wm="firestore",bc=class{constructor(){return Kl(wm)}};var Pc=new xl("angularfire2.firestore-instances");function my(r,t){let e=Gl(wm,r,t);return e&&new fs(e)}function gy(r){return(t,e)=>{let n=t.runOutsideAngular(()=>r(e));return new fs(n)}}var py={provide:bc,deps:[[new mr,Pc]]},yy={provide:fs,useFactory:my,deps:[[new mr,Pc],Wl]};function rw(r,...t){return pr("angularfire",$l.full,"fst"),Dl([yy,py,{provide:Pc,useFactory:gy(r),multi:!0,deps:[kl,Nl,Ql,Hl,[new mr,Xl],[new mr,Yl],...t]}])}var sw=Mt(_m,!0);var iw=Mt(Yf,!0,2);var ow=Mt(dm,!0,2);var aw=Mt(Xf,!0,2);var uw=Mt(lm,!0);var cw=Mt(Jf,!0);var lw=Mt(um,!0,2);var hw=Mt(om,!0,2);var dw=Mt(hm,!0,2);var fw=Mt(am,!0,2);export{iy as a,cy as b,Ny as c,ky as d,Fy as e,fs as f,rw as g,sw as h,iw as i,ow as j,aw as k,uw as l,cw as m,lw as n,hw as o,dw as p,fw as q};
